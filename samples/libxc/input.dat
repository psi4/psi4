#! compare libxc functionals against q-chem

import psi4

raw_data = """
       BMK,  -76.3467740301999953
  MGGA_MS1,  -76.3862902532000021
     B1LYP,  -76.3535228460000042
    HCTH93,  -76.3690763129000061
     MPW1K,  -76.3552269884000054
 MGGA_MS2h,  -76.3869769106999996
     TPSSh,  -76.3808999091999965
      PBE0,  -76.3005016022000007
 LRC-wPBEh,  -76.3099474275999938
    B3PW91,  -76.3571093335999933
      wB97,  -76.3673107324000000
       BOP,  -76.3668805134000053
     B3P86,  -76.4016429226000042
       M11,  -76.3543772135000012
      SCAN,  -76.3522444520999954
       GAM,  -76.3503663606000060
    M08-HX,  -76.3491613924000063
     wB97X,  -76.3624992838000054
  wB97X-D3,  -76.3623349598999965
  B5050LYP,  -76.3331923357000051
    t-HCTH,  -76.3696119945000049
       M06,  -76.3505257932000063
     SOGGA,  -75.9787739195000000
      BLYP,  -76.3664546594999933
     X3LYP,  -76.3549777562000003
    M05-2X,  -76.3677194866999969
     O3LYP,  -76.3591492039000030
 MGGA_MVSh,  -76.3353136572000039
     B1B95,  -76.3535230640000009
       M05,  -76.3485747591000035
    B97M-V,  -76.3589453714999991
      PKZB,  -76.2406599777000054
     B97-3,  -76.3648926369999970
     B97-D,  -76.3454808652000025
      TPSS,  -76.3892899530000022
   SOGGA11,  -76.3720408979000069
      BB1K,  -76.3467163717999995
     SCAN0,  -76.3378959734999967
    M06-2X,  -76.3484275867999997
      VV10,  -76.4798677308999970
     PBEOP,  -76.3127828460000046
  MGGA_MS2,  -76.3944104108999937
    MN12-L,  -76.3108795124000068
    N12-SX,  -76.3348397615000067
      dlDF,  -76.8411013061000006
   LRC-BOP,  -76.2292403170999933
      BP86,  -76.3866090626000016
   HCTH120,  -76.3758122673000059
      EDF1,  -76.3977299651999999
   LC-VV10,  -76.2988250068000013
   wB97M-V,  -76.3521809638999969
    M08-SO,  -76.3326680204000070
  MGGA_MVS,  -76.3422122700000045
   revPBE0,  -76.3464063106000026
     M06-L,  -76.3766451719999964
   t-HCTHh,  -76.3687401529000027
   HCTH407,  -76.3749350767999999
 CAM-B3LYP,  -76.3552415550000063
  MPW1PW91,  -76.3632666255000032
   MPW1B95,  -76.3499774107999940
   HCTH147,  -76.3796847321000030
    M06-HF,  -76.3434481261000002
    B3LYP5,  -76.3479641037999954
      PW91,  -76.3566903836999984
    wM05-D,  -76.3552811195000061
     B3LYP,  -76.3850600570000040
       PBE,  -76.2994484410999974
    MPWB1K,  -76.3440622810000065
     B97-K,  -76.3524930342999966
       B97,  -76.3580433464999970
    B1PW91,  -76.3655362477999944
      VSXC,  -76.4029268623999940
    BHHLYP,  -76.3412335768999952
   BP86VWN,  -76.3908828384000032
      EDF2,  -76.3447446499999955
     B97-2,  -76.3583804648000068
   wM06-D3,  -76.3595274034999960
   MPW1PBE,  -76.3392215485999941
     B97-1,  -76.3596966789999954
   wB97X-V,  -76.3536543513999959
     M11-L,  -76.3618441219000061
  LRC-wPBE,  -76.3232959073999950
     PWB6K,  -76.4078461235999953
    PW6B95,  -76.4628541226999943
    MN15-L,  -76.3001846795000063
  revTPSSh,  -76.3534592543000059
 SOGGA11-X,  -76.3569635031000047
   MN12-SX,  -76.3286624606000004
   wB97X-D,  -76.3616410164000001
   MPW1LYP,  -76.3513038013000056
     PBE50,  -76.3022364114000027
  MGGA_MS0,  -76.3991175407000043
       N12,  -76.3300056154999993
""".splitlines()

qchem_data = {}
for n, l in enumerate(raw_data):
    if not len(l): continue
    s, e = l.split(',')
    s = s.strip().upper()
    qchem_data[s] = float(e)

psi_data = {'wblyp': -76.3825262028083, 'svwn': -76.01452450629559, 'b97-0':
-76.35806217660348, 'b97-1': -76.35971389422123, 'b97-2': -76.3583977125692,
'pbe0': -76.30050128362014, 'pw91': -76.3565672871516, 'b2plyp':
-76.29245491066388, 'bp86': -76.38654294632472, 'wpbe2': -76.29220261052656,
'wpbe0': -76.31862941307556, 'wb97x': -76.36530303256407, 'sogga':
-75.97862074697434, 'wsvwn': -76.14201931003304, 'hcth120': -76.37582142613623,
'ft97': float('NaN'), 'wpbe': -76.33419490671916, 'wb97': -76.36737258172461, 'hcth147':
-76.37969122520059, 'dldf+d': -76.84110282525018, 'blyp': -76.36645993768678,
'hcth': -76.36908457666645, 'hcth407': -76.37494441125874, 'wb97x-d':
-76.36166004385153, 'b86bpbe': -76.36414509170982, 'm05': -76.34856555284622,
'dldf': -76.84110282525016, 'b97-d': -76.34549159283519, 'pw86pbe':
-76.42095771366442, 'm05-2x': -76.36772387978453, 'wpbesol': -76.0621570060994,
'pbe': -76.29945413106864, 'hf_x': -75.98014193516957, 'pbe0-2':
-76.21332533493145, 'wpbesol0': -76.1033355799836, 'wpbe_c':
-67.60822454944358, 'dldf+d09': -76.84110282525018,
'b3lyp5': -76.34796919664903, 'b3lyp': -76.38506652122132}
psi_data = {k.upper() : v for k, v in psi_data.items()}


mol = psi4.geometry("""
0 1
O
H 1 1.0
H 1 1.0 2 104.5
""")

psi4.core.set_global_option("BASIS", "6-31G")
psi4.core.set_output_file("output.dat", False)

#psi4.set_options({"dft_radial_scheme": "treutler",   # Rarely needed
#                  "dft_nuclear_scheme": "treutler"})  # Rarely needed

keys = list(set(list(psi_data)) | set(list(qchem_data))) 
#keys = [x for x in keys if "VV10" in x]
keys = ["PBE", "WPBE", "CAM-B3LYP", "B2PLYP", "DLDF+D09", "DSD-PBEP86"]
keys.sort()

print("           Functional:            libxc :      rob    qchem")


for key in keys:
    key = key.upper()
   
    energy = 0 
    try:
        energy = psi4.energy(key, molecule=mol)
    except:
        #print("Functional %s not found.. skipping" % key)
        continue


    qchem_energy = float('NaN')
    psi_energy = float('NaN')

    if key in list(qchem_data):
        qchem_energy = qchem_data[key]
    if key in list(psi_data):
        psi_energy = psi_data[key]

    psi_diff = abs(energy - psi_energy)
    qchem_diff = abs(energy - qchem_energy)

    spot = ""
    if (psi_diff > 1.e-6) or (qchem_diff > 1.e-4):
        spot = "*"

    qchem_energy = float('NaN')
    print("Comparison %10s: %16.10f : %8.2e %8.2e %s" % (key, energy, psi_diff, qchem_diff, spot))


