<!DOCTYPE html>

<html lang="English" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Release Procedures &#8212; Psi4 Documentation 1.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=29ef4520"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="release-procedures">
<h1>Release Procedures<a class="headerlink" href="#release-procedures" title="Link to this heading">¶</a></h1>
<section id="annual">
<span id="faq-annualprocedure"></span><h2>Annual<a class="headerlink" href="#annual" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#on-january-first">On January first</a></p></li>
<li><p><a class="reference internal" href="#update-copyright-year">Update copyright year</a></p></li>
<li><p><a class="reference internal" href="#update-counter-scripts">Update counter scripts</a></p></li>
</ul>
</section>
<section id="pre-release-e-g-v1-3rc1">
<span id="faq-prereleaseprocedure"></span><h2>Pre-Release (e.g., <code class="docutils literal notranslate"><span class="pre">v1.3rc1</span></code>)<a class="headerlink" href="#pre-release-e-g-v1-3rc1" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#update-samples">Update samples</a></p></li>
<li><p><a class="reference internal" href="#collect-new-authors">Collect new authors</a></p></li>
<li><p><a class="reference internal" href="#anticipate-next-release">Anticipate next release</a></p></li>
<li><p><a class="reference internal" href="#build-conda-ecosystem-stack">Build Conda ecosystem stack</a></p></li>
<li><p><a class="reference internal" href="#tag-pre-release">Tag (pre)release</a></p></li>
<li><p><a class="reference internal" href="#build-extra-conda-packages-for-psi4-channel">Build extra Conda packages for Psi4 channel</a></p></li>
<li><p><a class="reference internal" href="#build-psi4conda-set">Build Psi4conda set</a></p></li>
<li><p><a class="reference internal" href="#generate-download-page-for-psicode-org">Generate download page for psicode.org</a></p></li>
</ul>
</section>
<section id="release-e-g-v1-3">
<span id="faq-releaseprocedure"></span><h2>Release (e.g., <code class="docutils literal notranslate"><span class="pre">v1.3</span></code>)<a class="headerlink" href="#release-e-g-v1-3" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#update-samples">Update samples</a> (if no prerelease)</p></li>
<li><p><a class="reference internal" href="#collect-new-authors">Collect new authors</a> (if no prerelease)</p></li>
<li><p><a class="reference internal" href="#anticipate-next-release">Anticipate next release</a> (if no prerelease)</p></li>
<li><p><a class="reference internal" href="#build-conda-ecosystem-stack">Build Conda ecosystem stack</a> (if no prerelease)</p></li>
<li><p><a class="reference internal" href="#run-long-tests">Run long tests</a></p></li>
<li><p><a class="reference internal" href="#do-final-pass-before-release-tag">Do final pass before release tag</a></p></li>
<li><p><a class="reference internal" href="#tag-pre-release">Tag (pre)release</a></p></li>
<li><p><a class="reference internal" href="#initialize-release-branch">Initialize release branch</a></p></li>
<li><p><a class="reference internal" href="#build-extra-conda-packages-for-psi4-channel">Build extra Conda packages for Psi4 channel</a></p></li>
<li><p><a class="reference internal" href="#build-psi4conda-set">Build Psi4conda set</a></p></li>
<li><p><a class="reference internal" href="#generate-download-page-for-psicode-org">Generate download page for psicode.org</a></p></li>
<li><p><a class="reference internal" href="#collect-documentation-snapshot">Collect documentation snapshot</a></p></li>
<li><p><a class="reference internal" href="#publish-github-release">Publish GitHub release</a></p></li>
<li><p><a class="reference internal" href="#publish-psicode-org-release">Publish psicode.org release</a></p></li>
<li><p><a class="reference internal" href="#finalize-release">Finalize release</a></p></li>
</ul>
</section>
<section id="post-release-e-g-v1-8-2">
<span id="faq-postreleaseprocedure"></span><h2>Post-Release (e.g., <code class="docutils literal notranslate"><span class="pre">v1.8.2</span></code>)<a class="headerlink" href="#post-release-e-g-v1-8-2" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#assemble-postrelease-changes">Assemble postrelease changes</a></p></li>
<li><p><a class="reference internal" href="#tweak-conda-for-postrelease">Tweak Conda for postrelease</a></p></li>
<li><p><a class="reference internal" href="#tag-postrelease">Tag postrelease</a></p></li>
<li><p><a class="reference internal" href="#build-psi4conda-set">Build Psi4conda set</a></p></li>
<li><p><a class="reference internal" href="#build-extra-conda-packages-for-psi4-channel">Build extra Conda packages for Psi4 channel</a></p></li>
<li><p><a class="reference internal" href="#generate-download-page-for-psicode-org">Generate download page for psicode.org</a></p></li>
<li><p><a class="reference internal" href="#collect-documentation-snapshot">Collect documentation snapshot</a></p></li>
<li><p><a class="reference internal" href="#publish-github-postrelease">Publish GitHub postrelease</a></p></li>
<li><p><a class="reference internal" href="#publish-psicode-org-release">Publish psicode.org release</a></p></li>
<li><p><a class="reference internal" href="#finalize-release">Finalize release</a></p></li>
</ul>
</section>
<section id="on-january-first">
<h2>On January first<a class="headerlink" href="#on-january-first" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Screenshot <a class="reference external" href="https://anaconda.org/psi4/psi4">https://anaconda.org/psi4/psi4</a> .</p></li>
<li><p>Screenshot <a class="reference external" href="https://anaconda.org/conda-forge/psi4">https://anaconda.org/conda-forge/psi4</a> .</p></li>
<li><p>Add new year title and images to website
<a class="reference external" href="https://github.com/psi4/psicode-hugo-website/edit/master/content/posts/downloads.md">https://github.com/psi4/psicode-hugo-website/edit/master/content/posts/downloads.md</a> .</p></li>
<li><p>On the next day, check that the new year's plot appears at <a class="reference external" href="https://psicode.netlify.app/posts/downloads/">https://psicode.netlify.app/posts/downloads/</a> .</p></li>
</ul>
</section>
<section id="update-copyright-year">
<h2>Update copyright year<a class="headerlink" href="#update-copyright-year" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/path/to/psi4</span></code></p></li>
<li><p>Primary target is licenses</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-rl</span> <span class="pre">&quot;(c)</span> <span class="pre">2007-2017&quot;</span> <span class="pre">*</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">''</span> <span class="pre">&quot;s/(c)</span> <span class="pre">2007-2017/(c)</span> <span class="pre">2007-2018/g&quot;</span></code></p></li>
<li><p>On Linux, drop the <code class="docutils literal notranslate"><span class="pre">''</span></code> in above command</p></li>
<li><p>Need to do <code class="docutils literal notranslate"><span class="pre">psi4/</span></code> and <code class="docutils literal notranslate"><span class="pre">docs/</span></code> dirs</p></li>
</ul>
</li>
<li><p>Also, license in these files</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/runtest.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">README.md</span></code></p></li>
</ul>
</li>
<li><p>Also, in content of <a href="#id1"><span class="problematic" id="id2">:source:`doc/sphinxman/source/conf.py.in#L130`</span></a></p></li>
</ul>
</section>
<section id="update-counter-scripts">
<h2>Update counter scripts<a class="headerlink" href="#update-counter-scripts" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Log onto vergil as cdsgroup.</p></li>
<li><p>Add new years, Python versions, and Psi4 versions as needed.</p></li>
<li><p>check vergil /home/cdsgroup/psi4meta/download-analysis/installer: vi downloads_updater.py any new patterns to add?</p></li>
<li><p>check vergil if changing any download patterns</p></li>
</ul>
</section>
<section id="update-samples">
<h2>Update samples<a class="headerlink" href="#update-samples" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">sphinxman</span></code> at least once by hand</p></li>
<li><p>Check in resulting <code class="docutils literal notranslate"><span class="pre">psifiles.py</span></code> and all the updated and new <code class="docutils literal notranslate"><span class="pre">samples/</span></code> files and dirs</p></li>
<li><p>Make a lone PR and warn reviewers not to read it, since autogenerated</p></li>
</ul>
</section>
<section id="collect-new-authors">
<h2>Collect new authors<a class="headerlink" href="#collect-new-authors" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Survey contributions to current Milestone. Add new contributors to the release notes GitHub issue.</p></li>
<li><p>Figure out any new &quot;Additional Contributors&quot; authors since last release.</p></li>
<li><p>Get permission of new authors and their particulars for <code class="docutils literal notranslate"><span class="pre">codemeta.json</span></code>.</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">psi4/header.py</span></code> accordingly and make PR.</p></li>
</ul>
</section>
<section id="run-long-tests">
<h2>Run long tests<a class="headerlink" href="#run-long-tests" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Run the full test suite with threading parallelism on. There's one CC test that's a known fail
in parallel b/c it sets memory very low, iirc.</p>
<ul>
<li><p>CTest (CLI):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">runtest</span><span class="o">.</span><span class="n">py</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">104</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">104</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="k">def</span> <span class="nf">backtick</span><span class="p">(</span><span class="n">exelist</span><span class="p">):</span>

 <span class="c1"># run psi4 and collect testing status from any compare_* in input file</span>
 <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">infile</span><span class="p">):</span>
<span class="o">-</span>    <span class="n">exelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="n">psidatadir</span><span class="p">]</span>
<span class="o">+</span>    <span class="n">exelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="n">psidatadir</span><span class="p">,</span> <span class="s1">&#39;-n2&#39;</span><span class="p">]</span>
     <span class="c1"># On Windows set Python interpreter explicitly as the shebang is ignored</span>
     <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</pre></div>
</div>
</li>
<li><p>Pytest (API):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">pytests</span><span class="o">/</span><span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">22</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="k">def</span> <span class="nf">pytest_collection_modifyitems</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
 <span class="k">def</span> <span class="nf">set_up_overall</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path_factory</span><span class="p">):</span>
     <span class="kn">import</span> <span class="nn">psi4</span>

<span class="o">+</span>    <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">psi4</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="s2">&quot;pytest_output.dat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
     <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">tmp_path_factory</span><span class="o">.</span><span class="n">getbasetemp</span><span class="p">())</span>
     <span class="n">request</span><span class="o">.</span><span class="n">addfinalizer</span><span class="p">(</span><span class="n">tear_down</span><span class="p">)</span>

<span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">pytests</span><span class="o">/</span><span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">34</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">34</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="k">def</span> <span class="nf">set_up</span><span class="p">():</span>
     <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
     <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean_timers</span><span class="p">()</span>
     <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean_options</span><span class="p">()</span>
<span class="o">+</span>    <span class="n">psi4</span><span class="o">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">psi4</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="s2">&quot;pytest_output.dat&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Pytest (CLI):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">pytests</span><span class="o">/</span><span class="n">addons</span><span class="o">.</span><span class="n">py</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">223</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">223</span><span class="p">,</span><span class="mi">8</span> <span class="o">@@</span> <span class="k">def</span> <span class="nf">ctest_runner</span><span class="p">(</span><span class="n">inputdatloc</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">extra_infiles</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="n">No</span>
     <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.exe&quot;</span><span class="p">:</span>
         <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi4</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">inputdat</span><span class="p">]</span>
     <span class="k">else</span><span class="p">:</span>
<span class="o">-</span>        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">inputdat</span><span class="p">]</span>
<span class="o">-</span>    <span class="n">_</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">infiles_with_contents</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">scratch_messy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">+</span>        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">inputdat</span><span class="p">,</span> <span class="s2">&quot;-n2&quot;</span><span class="p">]</span>
<span class="o">+</span>    <span class="n">_</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">infiles_with_contents</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">scratch_messy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="n">success</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;proc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
     <span class="k">assert</span> <span class="n">success</span><span class="p">,</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;stdout&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;stderr&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Run a full stdsuite tests to generate new capabilities tables for docs. Detailed instructions are
in <a href="#id3"><span class="problematic" id="id4">:source:`psi4/share/psi4/scripts/merge_stdsuite.py`</span></a> .</p></li>
</ul>
</section>
<section id="anticipate-next-release">
<h2>Anticipate next release<a class="headerlink" href="#anticipate-next-release" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Bump version in <code class="docutils literal notranslate"><span class="pre">codemeta.json</span></code>, <a href="#id5"><span class="problematic" id="id6">:source:`codemeta.json#L9`</span></a></p></li>
<li><p>Add to branch list in <code class="docutils literal notranslate"><span class="pre">azure-pipelines.yml</span></code>, <a href="#id7"><span class="problematic" id="id8">:source:`azure-pipelines.yml`</span></a></p></li>
</ul>
</section>
<section id="build-conda-ecosystem-stack">
<h2>Build Conda ecosystem stack<a class="headerlink" href="#build-conda-ecosystem-stack" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>By &quot;ecosystem stack&quot;, we mean packages that are upstream, downstream, required, and optional for
a fully featured Psi4 build and which we have some role in packaging.</p></li>
<li><p>These packages (e.g., <code class="docutils literal notranslate"><span class="pre">libint</span></code>, <code class="docutils literal notranslate"><span class="pre">gdma</span></code>) should already be updated and built on conda-forge.
Survey them to check version tick and other key PRs have been merged.</p></li>
<li><p>Changes to targets' &quot;source&quot; and &quot;version&quot; in individual recipes should be edited in psi4
<code class="docutils literal notranslate"><span class="pre">external/*/*/CMakeLists.txt</span></code> files</p></li>
<li><p>Edit any added or dropped dependencies in main <a href="#id9"><span class="problematic" id="id10">:source:`CMakeLists.txt`</span></a> and docs
<a href="#id11"><span class="problematic" id="id12">:source:`doc/sphinxman/source/build_planning.rst`</span></a> .</p></li>
</ul>
</section>
<section id="assemble-postrelease-changes">
<h2>Assemble postrelease changes<a class="headerlink" href="#assemble-postrelease-changes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Collect PRs with &quot;backport&quot; label, and request other backport suggestions through slack.</p></li>
<li><p>Be on the maintenance branch (e.g., <code class="docutils literal notranslate"><span class="pre">1.8.x</span></code>). <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span> <span class="pre">upstream</span></code> or any other remotes you're
going to be cherry-picking from.</p></li>
<li><p>Cherry-pick backport PRs and commits (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">cherry-pick</span> <span class="pre">sha</span></code>), apply other changes manually, not
forgetting CI files or samples.</p></li>
<li><p>Possibly apply other changes manually, including:</p>
<ul>
<li><p>CI file tweaks like LLVM version or dependency constraint.</p></li>
<li><p>samples files from a docs build.</p></li>
<li><p><a href="#id13"><span class="problematic" id="id14">:source:`doc/sphinxman/source/introduction.rst`</span></a> for any compiler and Python minimum requirements to edit.</p></li>
</ul>
</li>
<li><p>Tag it (<a class="reference internal" href="#tag-postrelease">Tag postrelease</a> for details). This is needed to compute a version on a maintenance
branch to even run. Until the release is published on GH (final step of
<a class="reference internal" href="#publish-github-postrelease">Publish GitHub postrelease</a>), it's ok to revise a tag (force push to maintenance branch).</p>
<ul>
<li><p>Add or increment patch number in <code class="docutils literal notranslate"><span class="pre">psi4/metadata.py</span></code>; leave the &quot;z&quot;s. Commit file.</p></li>
<li><p>Tag with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span> <span class="pre">-a</span> <span class="pre">v1.8.2</span> <span class="pre">-m</span> <span class="pre">&quot;v1.8.2&quot;</span></code>, then push <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">--atomic</span> <span class="pre">upstream</span> <span class="pre">1.8.x</span> <span class="pre">v1.8.2</span></code>.</p></li>
</ul>
</li>
<li><p>Test core <a href="#id21"><span class="problematic" id="id22">|PSIfour|</span></a> thoroughly locally (ecosystem will get tested by c-f) by running
<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">../tests/</span> <span class="pre">-n</span> <span class="pre">auto</span></code> (psithon and psiapi tests). Possibly you may have to step back for
dependency versions from what master needs.</p></li>
<li><p>Start <a class="reference internal" href="#tweak-conda-for-postrelease">Tweak Conda for postrelease</a> PR at conda-forge. This will thoroughly test the ecosystem.</p></li>
<li><p>If more changes are needed, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span> <span class="pre">-d</span> <span class="pre">v1.8.2</span></code> to delete the tag, then make more commits,
retag, push, and repeat. Try to finalize the postrelease tag within a session or a day, so
tentative tags don't linger.</p></li>
<li><p>Start the draft parts of <a class="reference internal" href="#publish-github-postrelease">Publish GitHub postrelease</a> from the backported PRs assembled here.</p></li>
</ul>
</section>
<section id="tweak-conda-for-postrelease">
<h2>Tweak Conda for postrelease<a class="headerlink" href="#tweak-conda-for-postrelease" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Start a PR to <a class="reference external" href="https://github.com/conda-forge/psi4-feedstock">https://github.com/conda-forge/psi4-feedstock</a> . Always store the PR branch on your
fork, never on the conda-forge feedstock (or your branch itself will get publically packaged).
<a class="reference external" href="https://github.com/conda-forge/psi4-feedstock/pull/15">https://github.com/conda-forge/psi4-feedstock/pull/15</a> is an example.</p>
<ul>
<li><p>Always: edit <code class="docutils literal notranslate"><span class="pre">version</span></code> and <code class="docutils literal notranslate"><span class="pre">commit</span></code> jinja variables.</p></li>
<li><p>Possibly: edit <code class="docutils literal notranslate"><span class="pre">source/url</span></code> field for trial locations.</p></li>
<li><p>Always: edit <code class="docutils literal notranslate"><span class="pre">sha256</span></code> jinja variable from e.g., <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-sL</span> <span class="pre">https://github.com/psi4/psi4/archive/v1.8.2.tar.gz</span> <span class="pre">|</span> <span class="pre">openssl</span> <span class="pre">sha256</span></code></p></li>
<li><p>Always: edit <code class="docutils literal notranslate"><span class="pre">build/number</span></code>. Either reset to 0 if version increments or bump if version <em>doesn't</em> increment.</p></li>
<li><p>Possibly: uncomment <code class="docutils literal notranslate"><span class="pre">skip:</span> <span class="pre">true</span>&#160; <span class="pre">#</span> <span class="pre">[py</span> <span class="pre">!=</span> <span class="pre">310]</span></code> if you want to test one Python version on all
architectures before the whole build matrix (currently 16 builds). After editing this (and
opening the PR), you'll have to issue a comment <code class="docutils literal notranslate"><span class="pre">&#64;conda-forge-admin,</span> <span class="pre">please</span> <span class="pre">rerender</span></code> for the
matrix slimming to take effect.</p></li>
<li><p>Possibly: remove any old patches that are now in the main codebase.</p></li>
<li><p>Possibly: add in or remove any dependency or ecosystem packages.</p></li>
<li><p>Possibly: for any relevant addition, make sure <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">CMAKE_INSIST_FIND_PACKAGE_&lt;project&gt;=ON</span></code> or
<code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">ENABLE_&lt;project&gt;=ON</span></code> is set in <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>.</p></li>
<li><p>Possibly: add or release version constraints or architecture constraints (e.g., <code class="docutils literal notranslate"><span class="pre">[not</span> <span class="pre">win]</span></code>) on packages.</p></li>
</ul>
</li>
<li><p>Submit the PR and rerender (cmd above). Monitor the CI.</p></li>
<li><p>When all CI lanes are passing <em>and</em> the tag is final on the maintenance branch, rerender (may be
no-op) and merge the PR.</p></li>
<li><p>After all the packages are built on main and show up at <a class="reference external" href="https://anaconda.org/conda-forge/psi4/files">https://anaconda.org/conda-forge/psi4/files</a>
with a couple downloads, this means they're been mirrored and are generally installable. Announce
on slack general channel.</p></li>
</ul>
</section>
<section id="do-final-pass-before-release-tag">
<h2>Do final pass before release tag<a class="headerlink" href="#do-final-pass-before-release-tag" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Check that <a href="#id15"><span class="problematic" id="id16">:source:`external/`</span></a> repos and commits have been updated to match conda recipes sources. Also check versions with <code class="docutils literal notranslate"><span class="pre">conda_build_config.yaml</span></code></p></li>
<li><p>Check <a href="#id17"><span class="problematic" id="id18">:source:`doc/sphinxman/source/introduction.rst`</span></a> for any compiler and Python minimum requirements to edit.</p></li>
</ul>
</section>
<section id="tag-pre-release">
<h2>Tag (pre)release<a class="headerlink" href="#tag-pre-release" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Thorough version bump directions at master <a class="reference external" href="http://psicode.org/psi4manual/master/manage_git.html#how-to-bump-a-version">http://psicode.org/psi4manual/master/manage_git.html#how-to-bump-a-version</a></p></li>
<li><p>Below is tl;dr</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># be on clean master up-to-date with upstream in both commits and tags</span>
<span class="c1"># * mind which version strings get &quot;v&quot; and which don&#39;t</span>
<span class="c1"># * if not fork, replace &quot;upstream&quot; with &quot;origin&quot;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">vi</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">diff</span>
<span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span> <span class="n">b</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>
<span class="o">-</span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.3rc1&#39;</span>
<span class="o">-</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3rc1+5a7522a&#39;</span>
<span class="o">-</span><span class="n">__version_upcoming_annotated_v_tag</span> <span class="o">=</span> <span class="s1">&#39;1.3rc2&#39;</span>
<span class="o">+</span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.3rc2&#39;</span>
<span class="o">+</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3rc2+zzzzzzz&#39;</span>
<span class="o">+</span><span class="n">__version_upcoming_annotated_v_tag</span> <span class="o">=</span> <span class="s1">&#39;1.3rc3&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">add</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;v1.3rc2&quot;</span>
<span class="p">[</span><span class="n">master</span> <span class="n">bc8d7f5</span><span class="p">]</span> <span class="n">v1</span><span class="mf">.3</span><span class="n">rc2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">oneline</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">bc8d7f5</span> <span class="n">v1</span><span class="mf">.3</span><span class="n">rc2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">tag</span> <span class="o">-</span><span class="n">a</span> <span class="n">v1</span><span class="mf">.3</span><span class="n">rc2</span> <span class="n">bc8d7f5</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;v1.3rc2&quot;</span>

<span class="c1"># goto GH:psi4/psi4 &gt; Settings &gt; Branches &gt; master &gt; Edit</span>
<span class="c1">#      https://github.com/psi4/psi4/settings/branch_protection_rules/424295</span>
<span class="c1"># uncheck &quot;Do not allow bypassing the above settings&quot; for admins and Save changes</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">atomic</span> <span class="n">upstream</span> <span class="n">master</span> <span class="n">v1</span><span class="mf">.3</span><span class="n">rc2</span>

<span class="c1"># pause here and push to upstream and let Azure complete for an</span>
<span class="c1">#       on-tag Windows conda package and docs, not tag+1.dev1 .</span>
<span class="c1">#       the atomic flag below pushes commit and tag together so only one CI</span>
<span class="c1">#       which is necessary for Windows conda package to compute the right version.</span>
<span class="c1">#       After push, can temporarily re-engage admins &quot;Do not allow ...&quot; protections.</span>
<span class="c1">#       also, grab the docs build from GHA artifacts</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">vi</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">diff</span>
<span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span> <span class="n">b</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>
<span class="o">-</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3rc2+zzzzzzz&#39;</span>
<span class="o">+</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3rc2+bc8d7f5&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">add</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Records tag for v1.3rc2&quot;</span>
<span class="p">[</span><span class="n">master</span> <span class="mi">16</span><span class="n">dbd3e</span><span class="p">]</span> <span class="n">Records</span> <span class="n">tag</span> <span class="k">for</span> <span class="n">v1</span><span class="mf">.3</span><span class="n">rc2</span>

<span class="c1"># goto GH:psi4/psi4 &gt; Settings &gt; Branches &gt; master &gt; Edit</span>
<span class="c1">#      https://github.com/psi4/psi4/settings/branch_protection_rules/424295</span>
<span class="c1"># uncheck admins &quot;Do not allow ...&quot; and Save changes</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">push</span> <span class="n">upstream</span> <span class="n">master</span>

<span class="c1"># re-engage admins &quot;Do not allow ...&quot; protections</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tag-postrelease">
<h2>Tag postrelease<a class="headerlink" href="#tag-postrelease" title="Link to this heading">¶</a></h2>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># be on clean maintenance branch up-to-date with upstream in both commits and tags</span>
<span class="c1"># * mind which version strings get &quot;v&quot; and which don&#39;t</span>
<span class="c1"># * if not fork, replace &quot;upstream&quot; with &quot;origin&quot;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">checkout</span> <span class="mf">1.3</span><span class="o">.</span><span class="n">x</span>
<span class="n">Switched</span> <span class="n">to</span> <span class="n">branch</span> <span class="s1">&#39;1.3.x&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">vi</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">diff</span>
<span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span> <span class="n">b</span><span class="o">/</span><span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>
<span class="o">-</span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.3&#39;</span>
<span class="o">-</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3+zzzzzzz&#39;</span>
<span class="o">+</span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.3.1&#39;</span>
<span class="o">+</span><span class="n">__version_long</span> <span class="o">=</span> <span class="s1">&#39;1.3.1+zzzzzzz&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">add</span> <span class="n">psi4</span><span class="o">/</span><span class="n">metadata</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;v1.3.1&quot;</span>
<span class="p">[</span><span class="mf">1.3</span><span class="o">.</span><span class="n">x</span> <span class="mi">2</span><span class="n">ce1c29</span><span class="p">]</span> <span class="n">v1</span><span class="mf">.3.1</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">oneline</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="mi">1</span>
<span class="mi">786</span><span class="n">fb2b</span> <span class="n">v1</span><span class="mf">.3.1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">tag</span> <span class="o">-</span><span class="n">a</span> <span class="n">v1</span><span class="mf">.3.1</span> <span class="mi">2</span><span class="n">ce1c29</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;v1.3.1&quot;</span>

<span class="c1"># skipping the hash recording and &quot;upcoming&quot; step b/c only tags matter on maintenance branch</span>

<span class="c1"># free pushing to maintenance branches at present so GitHub interface steps not needed</span>

<span class="c1"># see note at &quot;Tag (pre)release&quot; for why atomic commit needed. Collect docs from GHA artifacts.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">atomic</span> <span class="n">upstream</span> <span class="mf">1.3</span><span class="o">.</span><span class="n">x</span> <span class="n">v1</span><span class="mf">.3.1</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="initialize-release-branch">
<h2>Initialize release branch<a class="headerlink" href="#initialize-release-branch" title="Link to this heading">¶</a></h2>
<ul>
<li><p>follow tagging procedure</p></li>
<li><p>before re-engaging the admins &quot;Do not allow ...&quot; button, push a branch at the tag commit (not the records commit)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">online</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="mi">2</span>
<span class="go">45315cb Records tag for v1.3</span>
<span class="go">20e5c7e v1.3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">git</span> <span class="n">checkout</span> <span class="mf">20e5</span><span class="n">c7e</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="mf">1.3</span><span class="o">.</span><span class="n">x</span>
<span class="go">Switched to a new branch &#39;1.3.x&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">git</span> <span class="n">push</span> <span class="n">upstream</span> <span class="mf">1.3</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</li>
<li><p>set up new branch as protected branch through GitHub psi4 org Settings. Should be already covered under 1.*.x rule.</p></li>
</ul>
</section>
<section id="build-extra-conda-packages-for-psi4-channel">
<h2>Build extra Conda packages for Psi4 channel<a class="headerlink" href="#build-extra-conda-packages-for-psi4-channel" title="Link to this heading">¶</a></h2>
<p>Once upon a time, &quot;Psi4 stack&quot;, meant packages <code class="docutils literal notranslate"><span class="pre">psi4</span></code>, <code class="docutils literal notranslate"><span class="pre">psi4-rt</span></code>, <code class="docutils literal notranslate"><span class="pre">psi4-dev</span></code>, and <code class="docutils literal notranslate"><span class="pre">psi4-docs</span></code>.
Package <code class="docutils literal notranslate"><span class="pre">psi4-docs</span></code> used to be in &quot;Psi4 stack&quot;, but it's handled by GHA and netlify now, not Conda.
Package <code class="docutils literal notranslate"><span class="pre">psi4-rt</span></code> used to be in &quot;Psi4 stack&quot;, but a maximum ecosystem package isn't provided now, only a customizable env spec.
Package <code class="docutils literal notranslate"><span class="pre">psi4-dev</span></code> used to be in &quot;Psi4 stack&quot;, but now build environment and guidance is in-repo with <code class="docutils literal notranslate"><span class="pre">psi4-path-advisor.py</span></code>.
Other packages in the &quot;ecosystem stack&quot; (e.g., <code class="docutils literal notranslate"><span class="pre">libint</span></code>, <code class="docutils literal notranslate"><span class="pre">gdma</span></code>) should already be updated and
built on conda-forge. Survey them to check version tick PRs have been merged.</p>
<p>Conda-forge overwhelmingly handles the <code class="docutils literal notranslate"><span class="pre">psi4</span></code> package itself, with a full architecture and Python
version matrix. What remains are specialty or development builds for the psi4 channel.</p>
<ul class="simple">
<li><p>High AM and multiarch <code class="docutils literal notranslate"><span class="pre">psi4</span></code> builds for Linux</p>
<ul>
<li><p>Especially at tagged releases, update and reconcile c-f psi4/feedstock recipe with psinet
psi4meta/conda-recipes/psi4-cf recipe. Differences include:</p>
<ul>
<li><p>restricted to only even python versions</p></li>
<li><p>c-f libint vs. psi4 libint2 packages (latter with high AM)</p></li>
<li><p>smoke vs. full tests</p></li>
<li><p>no git rev-parse lines</p></li>
<li><p>load Intel compilers and specify them in compilers and flags CMake arguments</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Prepare recipe, make sure <code class="docutils literal notranslate"><span class="pre">psi4-cf</span></code> is the only target uncommented in <code class="docutils literal notranslate"><span class="pre">kitandkapoodle.py</span></code>, set
crontab, view in <code class="docutils literal notranslate"><span class="pre">kpd-anom.log</span></code>.</p></li>
<li><p>Files will upload to <code class="docutils literal notranslate"><span class="pre">psi4/label/dev</span></code>. For releases and postreleases, on the anaconda.org site
(logged in as psi4), <em>add</em>, not replace, <code class="docutils literal notranslate"><span class="pre">main</span></code> label, so accessible from <code class="docutils literal notranslate"><span class="pre">psi4/label/main</span></code>.</p></li>
</ul>
</section>
<section id="build-psi4conda-set">
<h2>Build Psi4conda set<a class="headerlink" href="#build-psi4conda-set" title="Link to this heading">¶</a></h2>
<p>Installers are build using the project <code class="docutils literal notranslate"><span class="pre">constructor</span></code> to build binary bash or exe scripts, one per
OS per Python version. For example, there's 16 installers when OSes are linux-64, win-64, osx-64,
osx-arm64 and pythons are 38, 39, 310, 311. In analogy to Miniconda, they're called Psi4Conda. They
are built through GHA on the <a class="reference external" href="https://github.com/psi4/psi4meta">https://github.com/psi4/psi4meta</a> repository and get served from vergil
(the cdsgroup webserver).</p>
<ul class="simple">
<li><p>If the previous release hasn't had a snapshot saved, copy <code class="docutils literal notranslate"><span class="pre">construct.yaml</span></code> into a version-labeled
file and check it in.</p></li>
<li><p>Edit recipe <a class="reference external" href="https://github.com/psi4/psi4meta/blob/master/installers/construct.yaml">https://github.com/psi4/psi4meta/blob/master/installers/construct.yaml</a></p>
<ul>
<li><p>Edit the top matter for Configuration, mainly the <code class="docutils literal notranslate"><span class="pre">release</span></code> field. See snapshots in directory for examples.</p></li>
<li><p>Edit the packages and channels info if necessary. Probably long-term stable.</p></li>
</ul>
</li>
<li><p>Edit the GHA control file <a class="reference external" href="https://github.com/psi4/psi4meta/blob/master/.github/workflows/Installers.yml">https://github.com/psi4/psi4meta/blob/master/.github/workflows/Installers.yml</a>
<code class="docutils literal notranslate"><span class="pre">matrix.cfg</span></code> list if Python versions or target architectures have changed.</p></li>
<li><p>All conda packages must already have been built and present in the right channels on
<a class="reference external" href="https://anaconda.org/conda-forge/psi4/files">https://anaconda.org/conda-forge/psi4/files</a> .</p></li>
<li><p>Commit <code class="docutils literal notranslate"><span class="pre">construct.yaml</span></code> to trigger installer builds. (Even workflow edits need a dummy commit to
<code class="docutils literal notranslate"><span class="pre">construct.yaml</span></code> to retrigger.)</p></li>
<li><p>When all build successfully, hover over the artifacts, and note the smallest and largest of the
near-consecutive numbers GH has assigned them. These artifacts only linger for a day.</p></li>
<li><p>Log in to vergil root and cd to <code class="docutils literal notranslate"><span class="pre">/var/www/html/psicode-download</span></code>.</p></li>
<li><p>Use the pull_gha_installers.sh script to download the installers from GH to vergil. First two
arguments are first and last of the artifact numbers, and third argument is an auth token.
<code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">pull_gha_installers.sh</span> <span class="pre">47226565</span> <span class="pre">47226573</span> <span class="pre">715...4f3</span></code>.</p></li>
<li><p>Make WindowsWSL and any other symlinks the script frontmatter advises.</p></li>
</ul>
</section>
<section id="build-docker-images">
<h2>Build Docker images<a class="headerlink" href="#build-docker-images" title="Link to this heading">¶</a></h2>
<p>Docker images are built through GHA on the <a class="reference external" href="https://github.com/psi4/psi4meta">https://github.com/psi4/psi4meta</a> repository from a Conda
environment specification and get served from DockerHub, <a class="reference external" href="https://hub.docker.com/r/psi4/psi4/tags">https://hub.docker.com/r/psi4/psi4/tags</a> .</p>
<ul class="simple">
<li><p>Edit specification <a class="reference external" href="https://github.com/psi4/psi4meta/blob/master/docker/environment.yaml">https://github.com/psi4/psi4meta/blob/master/docker/environment.yaml</a></p>
<ul>
<li><p>Edit the packages and channels info if necessary. Probably long-term stable.</p></li>
<li><p>Don't edit the Python version, as that's controlled by the GHA.</p></li>
</ul>
</li>
<li><p>Edit the GHA control file <a class="reference external" href="https://github.com/psi4/psi4meta/blob/master/.github/workflows/Docker.yml">https://github.com/psi4/psi4meta/blob/master/.github/workflows/Docker.yml</a>
<code class="docutils literal notranslate"><span class="pre">matrix.cfg</span></code> list for changed Python version and to label the tags with current Psi4 from c-f.</p></li>
<li><p>Commit <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">Docker.yml</span></code> to trigger GHA Docker builds.</p></li>
<li><p>Check at DockerHub for new images.</p></li>
</ul>
</section>
<section id="generate-download-page-for-psicode-org">
<h2>Generate download page for psicode.org<a class="headerlink" href="#generate-download-page-for-psicode-org" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Be in local clone of repository <a class="reference external" href="https://github.com/psi4/psicode-hugo-website">https://github.com/psi4/psicode-hugo-website</a> .</p></li>
<li><p>Copy and edit a new file akin to <code class="docutils literal notranslate"><span class="pre">content/installs/v182.md</span></code>. Add it to the git index.</p>
<ul>
<li><p>Note the edition string <code class="docutils literal notranslate"><span class="pre">v182</span></code> in frontmatter for this and future filenames.</p></li>
<li><p>Don't postdate the date string in frontmatter or it won't render.</p></li>
<li><p>Ultimately, make sure the <code class="docutils literal notranslate"><span class="pre">aliases:\n</span>&#160; <span class="pre">-</span> <span class="pre">/installs/latest/</span></code> lines are <em>added</em> to this new file
and <em>removed</em> from the previous latest file, but this can wait until the installer page has been tested.</p></li>
</ul>
</li>
<li><p>Copy and edit a new file akin to <code class="docutils literal notranslate"><span class="pre">data/installs/v182.yaml</span></code>. Add it to the git index.</p>
<ul>
<li><p>Glance through the menu and notes content to make sure they're up-to-date. This file determines
the structure of the install page.</p></li>
<li><p>Add or remove python versions and architectures if necessary.</p></li>
<li><p>Every couple years, update the default python version in <code class="docutils literal notranslate"><span class="pre">datakey:</span> <span class="pre">python</span></code>/<code class="docutils literal notranslate"><span class="pre">selected</span></code> <em>and</em>
in <code class="docutils literal notranslate"><span class="pre">optsHandler</span></code> at the end.</p></li>
<li><p>Always adjust the <code class="docutils literal notranslate"><span class="pre">datakey:</span> <span class="pre">branch</span></code>/<code class="docutils literal notranslate"><span class="pre">stable</span></code> block.</p></li>
<li><p>For releases, adjust the <code class="docutils literal notranslate"><span class="pre">datakey:</span> <span class="pre">branch</span></code>/<code class="docutils literal notranslate"><span class="pre">previous</span></code> and <code class="docutils literal notranslate"><span class="pre">nightly</span></code> blocks.</p></li>
</ul>
</li>
<li><p>Enter the <code class="docutils literal notranslate"><span class="pre">scripts/</span></code> directory. If the previous release hasn't had a snapshot saved, copy
<code class="docutils literal notranslate"><span class="pre">install-generator.py</span></code> into a version-labeled file, and add it to the git index.</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">scripts/install-generator.py</span></code>.</p>
<ul>
<li><p>Primarily, edit <code class="docutils literal notranslate"><span class="pre">edition</span></code> at the top.</p></li>
<li><p>Also, edit other arrays (stuff above <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Outputs</span></code>) or messages (logic below <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Outputs</span></code>)
that should change.</p></li>
</ul>
</li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">install-generator.py</span></code> in place. It will dump two new files, e.g.,
<code class="docutils literal notranslate"><span class="pre">data/installs/cmd/{edition}.json</span></code> and <code class="docutils literal notranslate"><span class="pre">data/installs/dlbtn/{edition}.json</span></code>. Add these to the
index (no need to inspect them).</p></li>
<li><p>The installer page is now ready for inspection. Run <code class="docutils literal notranslate"><span class="pre">hugo</span> <span class="pre">server</span> <span class="pre">--watch=false</span></code> and view in
browser at <a class="reference external" href="http://localhost:1313/">http://localhost:1313/</a> . Click around the options to make sure the buttons and
instructions all look right.</p></li>
<li><p>Iterate on the <code class="docutils literal notranslate"><span class="pre">data/installs/{edition}.yaml</span></code> and the <code class="docutils literal notranslate"><span class="pre">install-generator.py</span></code> until correct.
It's fine to push to psicode.org to see it in place. But wait until it's final (and all the
packages and installers are ready) to shift &quot;latest&quot; alias in frontmatter from whichever page is
currently active to the new page, <code class="docutils literal notranslate"><span class="pre">content/installs/{edition}.md</span></code>. This makes sure &quot;Downloads&quot;
on the navigation bar points to the new page.</p></li>
<li><p>Commit the new files, PR, and deploy psicode site.</p></li>
</ul>
</section>
<section id="collect-documentation-snapshot">
<h2>Collect documentation snapshot<a class="headerlink" href="#collect-documentation-snapshot" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Documentation is built automatically by GHA from the latest psi4 master commit. It gets pushed to
a special &quot;master&quot; folder on the <a class="reference external" href="https://github.com/psi4/psi4docs">https://github.com/psi4/psi4docs</a> repository. From there, it and
other docs snapshots are built and served to <a class="reference external" href="https://psi4.github.io/psi4docs/master/">https://psi4.github.io/psi4docs/master/</a> (independent
of psicode.org). The netlify psicode.org site has a redirect so that
<a class="reference external" href="https://psicode.org/psi4manual/master/index.html">https://psicode.org/psi4manual/master/index.html</a> presents the psi4docs repo content.</p>
<ul>
<li><p>GHA sphinx-build controller is <a href="#id19"><span class="problematic" id="id20">:source:`.github/workflows/docs.yml`</span></a></p></li>
<li><p>GHA gh-pages deploy controller is <a class="reference external" href="https://github.com/psi4/psi4docs/blob/master/.github/workflows/docs.yml">https://github.com/psi4/psi4docs/blob/master/.github/workflows/docs.yml</a></p></li>
<li><p>Netlify psicode redirect controller is <a class="reference external" href="https://github.com/psi4/psicode-hugo-website/blob/master/netlify.toml#L10-L15">https://github.com/psi4/psicode-hugo-website/blob/master/netlify.toml#L10-L15</a></p></li>
</ul>
</li>
<li><p>This setup works great for &quot;latest&quot; docs, but it won't necessarily build a nice copy on the tag
commit itself for release and postrelease snapshots. Get a snapshot <em>on the tag</em> by some means:</p>
<ul>
<li><p>For releases and postreleases, any commit to the maintenance branch will build docs and upload
to the branch name in psi4docs. This should be pre-positioned by GHA, so check that docs with
the right version are deployed and then no further action required (can skip ahead to README.md
and netlify.toml steps).</p></li>
<li><p>For releases, you can do the <code class="docutils literal notranslate"><span class="pre">atomic</span></code> push of the tag commit, wait for the docs build to
complete, download the GHA artifact (zipped docs dir), then continue by pushing the record commit.</p></li>
<li><p>For releases beyond the <code class="docutils literal notranslate"><span class="pre">atomic</span></code> push, navigate on psi4 GH to the tag commit (not the record
commit) and retrigger the docs GHA, then download the GHA artifact (zipped docs dir).</p></li>
<li><p>For postreleases, build the docs locally at the tag and collect the docs dir.</p></li>
</ul>
</li>
<li><p>In your local clone of <a class="reference external" href="https://github.com/psi4/psi4docs">https://github.com/psi4/psi4docs</a>, find the appropriate folder and unpack
your docs snapshot into it.</p>
<ul>
<li><p>For releases, you'll need to make a new folder, e.g. <code class="docutils literal notranslate"><span class="pre">sphinxman/1.8.x</span></code>.</p></li>
<li><p>For postreleases, you'll overwrite the contents of the existing folder.</p></li>
<li><p>Unpack and rearrange so that in the end, e.g., <code class="docutils literal notranslate"><span class="pre">sphinxman/1.8.x/index.html</span></code> is present.</p></li>
</ul>
</li>
<li><p>Commit all your docs files and push to <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p></li>
<li><p>For releases, add a line to the top-level table <a class="reference external" href="https://github.com/psi4/psi4docs/edit/master/README.md">https://github.com/psi4/psi4docs/edit/master/README.md</a> .</p></li>
<li><p>For releases, add a new redirects block to <a class="reference external" href="https://github.com/psi4/psicode-hugo-website/edit/master/netlify.toml">https://github.com/psi4/psicode-hugo-website/edit/master/netlify.toml</a> .</p></li>
<li><p>Details:</p>
<ul>
<li><p>If you sequentially push the tag commit, push the tag, push the record commit, GHA will build the docs at v1.{Y+1}.dev1, not at v1.Y .</p></li>
<li><p>If you sequentially push the tag commit, then push the tag, GHA will build the docs at the tag commit, but the version will show up as &quot;undefined&quot;.</p></li>
<li><p>If you <code class="docutils literal notranslate"><span class="pre">atomic</span></code> push the tag commit and tag together and wait, GHA will build the docs at v1.Y, as desired.</p></li>
</ul>
</li>
</ul>
</section>
<section id="publish-github-release">
<h2>Publish GitHub release<a class="headerlink" href="#publish-github-release" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>With an anticipated or newly minted tag, go to <a class="reference external" href="https://github.com/psi4/psi4/releases/new">https://github.com/psi4/psi4/releases/new</a> (or
&quot;Draft a new release&quot; button on GitHub site).</p></li>
<li><p>Release title takes the form: <code class="docutils literal notranslate"><span class="pre">v1.8,</span> <span class="pre">2023-05-11</span></code></p></li>
<li><p>Fill in frontmatter style and links from previous GitHub release</p></li>
<li><p>Fill in RN from hopefully existing RN issue.</p></li>
<li><p>Fill in RN by going through the frontmatter from all PRs from this milestone, particularly the
&quot;User API &amp; Changelog headlines&quot; section.</p></li>
<li><p>Save the draft release until tag is finalized.</p></li>
<li><p>&quot;publish&quot; release. This establishes the release date for the GitHub API.</p></li>
<li><p>Close the RN issue.</p></li>
<li><p>Close the milestone (should be 100% complete).</p></li>
<li><p>Open a milestone for the release that's a year out.</p></li>
</ul>
</section>
<section id="publish-github-postrelease">
<h2>Publish GitHub postrelease<a class="headerlink" href="#publish-github-postrelease" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>With an anticipated or newly minted tag, go to <a class="reference external" href="https://github.com/psi4/psi4/releases/new">https://github.com/psi4/psi4/releases/new</a> (or
&quot;Draft a new release&quot; button on GitHub site).</p></li>
<li><p>Release title takes the form: <code class="docutils literal notranslate"><span class="pre">v1.8.2,</span> <span class="pre">2023-10-03</span></code></p></li>
<li><p>Fill in frontmatter style and links from previous GitHub release.</p></li>
<li><p>Fill in RN bullets for changes cherry-picked or edited to the maintenance branch.</p></li>
<li><p>Save the draft release until tag is finalized.</p></li>
<li><p>&quot;publish&quot; release. This establishes the release date for the GitHub API.</p></li>
</ul>
</section>
<section id="publish-psicode-org-release">
<h2>Publish psicode.org release<a class="headerlink" href="#publish-psicode-org-release" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Be in local clone of repository <a class="reference external" href="https://github.com/psi4/psicode-hugo-website">https://github.com/psi4/psicode-hugo-website</a> .</p></li>
<li><p>Execute <a class="reference external" href="https://api.github.com/repos/psi4/psi4/releases/latest">https://api.github.com/repos/psi4/psi4/releases/latest</a> or
<a class="reference external" href="https://api.github.com/repos/psi4/psi4/releases/tags/v1.8.2">https://api.github.com/repos/psi4/psi4/releases/tags/v1.8.2</a> (substituting tag) and note the <code class="docutils literal notranslate"><span class="pre">id</span></code>
field value.</p></li>
<li><p>Copy and edit a new file akin to <code class="docutils literal notranslate"><span class="pre">content/posts/v182.md</span></code>. Add it to the git index.</p>
<ul>
<li><p>e.g., <code class="docutils literal notranslate"><span class="pre">v1.8.2</span></code> is used for Title and Release Notes.</p></li>
<li><p>e.g., <code class="docutils literal notranslate"><span class="pre">1.8.x</span></code> is used for Documentation and Source.</p></li>
<li><p>e.g., <code class="docutils literal notranslate"><span class="pre">v182</span></code> (edition string) is used for Image and Installers.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">id</span></code> value in the shortcode call at the bottom near <code class="docutils literal notranslate"><span class="pre">ghRN</span></code>.</p></li>
</ul>
</li>
<li><p>Add a new release page to the <code class="docutils literal notranslate"><span class="pre">psi4_release_fireworks.key</span></code> Keynote presentation. Run the slide
transition and screenshot the fireworks. Open the PNG file in Preview and save as JPEG while
downsampling to ~400kB. Place the file at e.g., <code class="docutils literal notranslate"><span class="pre">static/images/portfolio/fireworks_slide_v182.jpg</span></code>.
Add it to the git index.</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">data/portfolio.yml</span></code> to add a new block for the release (order matters).</p></li>
<li><p>Include these changes in a PR. Check the generated preview if needed. Merge the PR yourself or ask
for it to be merged.</p></li>
</ul>
</section>
<section id="finalize-release">
<h2>Finalize release<a class="headerlink" href="#finalize-release" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Make new PR with
* edits to main <code class="docutils literal notranslate"><span class="pre">README.md</span></code> badges, python versions, etc.</p></li>
<li><p>Tweet about release</p></li>
</ul>
</section>
<section id="misc">
<h2>Misc.<a class="headerlink" href="#misc" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Consider rebuilding the <a href="#id23"><span class="problematic" id="id24">|PSIfour|</span></a> binder image.</p></li>
<li><p>If you want to do trial conda builds from a maintenance branch w/o pushing the tag, requires
<code class="docutils literal notranslate"><span class="pre">source/git_tag:</span> <span class="pre">1.3.x</span></code> and fake <code class="docutils literal notranslate"><span class="pre">package/version:</span> <span class="pre">v1.3.1rc1</span></code></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Psi4 Documentation</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Harishankar.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/doc/sphinxman/source/manage_release.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>