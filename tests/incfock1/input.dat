#! Test INCFOCK with screening=NONE (regression test for null pointer crash fix)
#! Validates energy AND iteration count match IncFock OFF

print(' INCFOCK with screening=NONE') #TEST

molecule water {
    O
    H 1 0.96
    H 1 0.96 2 104.5
}

# Reference values from incfock=false runs
Eref = -76.026653661889
Iref = 16

set {
    basis cc-pvdz
    scf_type direct
    screening none
    incfock true
    incfock_convergence 1e-10
    e_convergence 1e-10
    d_convergence 1e-8
}

# RHF with INCFOCK + screening=NONE
set reference rhf
E, wfn = energy('scf', return_wfn=True)
compare_values(Eref, E, 8, 'RHF INCFOCK NONE: Energy') #TEST
compare_integers(Iref, wfn.iteration_, 'RHF INCFOCK NONE: Iterations') #TEST

clean()

# UHF with INCFOCK + screening=NONE
set reference uhf
E, wfn = energy('scf', return_wfn=True)
compare_values(Eref, E, 8, 'UHF INCFOCK NONE: Energy') #TEST
compare_integers(Iref, wfn.iteration_, 'UHF INCFOCK NONE: Iterations') #TEST
