#! test FCIDUMP functionality for rhf/uhf

molecule ne {
  Ne  0  0  0
}

set {
  basis 6-311g
  scf_type pk
  reference rhf
  d_convergence 1e-8
  e_convergence 1e-8
}

if psi4.core.get_option("scf", "orbital_optimizer_package") == "INTERNAL":
    fci_tol = 10
else:
    fci_tol = 8

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 9, "d_convergence": 8e-8})

scf_e, scf_wfn = energy('SCF', return_wfn=True)
fcidump(scf_wfn, fname='Ne.6311G.INTDUMP', oe_ints=['EIGENVALUES'])
compare_fcidumps('Ne.6311G.INTDUMP.ref', 'Ne.6311G.INTDUMP', '[1] Ne, 6-311g, integrals in FCIDUMP format', fci_tol) # TEST
clean()

set {
  basis 6-311g
  scf_type pk
  reference rhf
  d_convergence 1e-8
  e_convergence 1e-8
  num_frozen_docc 2
  num_frozen_uocc 4
}

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 9, "d_convergence": 8e-8})

scf_e, scf_wfn = energy('SCF', return_wfn=True)
fcidump(scf_wfn, fname='Ne.6311G.frozen.INTDUMP', oe_ints=['EIGENVALUES'])
compare_fcidumps('Ne.6311G.frozen.INTDUMP.ref', 'Ne.6311G.frozen.INTDUMP', '[2] Ne, 6-311g, some frozen core and virtual orbitals, integrals in FCIDUMP format', fci_tol) # TEST
clean()

set {
  basis cc-pvdz
  scf_type pk
  reference uhf
  d_convergence 1e-8
  e_convergence 1e-8
  num_frozen_docc 0
  num_frozen_uocc 0
}

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 10, "d_convergence": 6e-8})

scf_e, scf_wfn = energy('SCF', return_wfn=True)
fcidump(scf_wfn, fname='Ne.cc-pVDZ.UHF.INTDUMP', oe_ints=['EIGENVALUES'])
compare_fcidumps('Ne.cc-pVDZ.UHF.INTDUMP.ref', 'Ne.cc-pVDZ.UHF.INTDUMP', '[3] Ne, cc-pVDZ, UHF reference, integrals in FCIDUMP format', fci_tol) # TEST
clean()

# Now run without symmetry
ne.reset_point_group('C1')

set {
  basis 6-311g
  scf_type pk
  reference rhf
  d_convergence 1e-8
  e_convergence 1e-8
}

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 9, "d_convergence": 7e-8})

scf_e, scf_wfn = energy('SCF', return_wfn=True)
fcidump(scf_wfn, fname='Ne.C1.6311G.INTDUMP', oe_ints=['EIGENVALUES'])
compare_fcidumps('Ne.C1.6311G.INTDUMP.ref', 'Ne.C1.6311G.INTDUMP', '[4] Ne, C1, 6-311g, integrals in FCIDUMP format', fci_tol)  # TEST
clean()

set {
  basis cc-pvdz
  scf_type pk
  reference uhf
  d_convergence 1e-8
  e_convergence 1e-8
}

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 9, "d_convergence": 3e-8})
    fci_tol = 8

scf_e, scf_wfn = energy('SCF', return_wfn=True)
fcidump(scf_wfn, fname='Ne.C1.cc-pVDZ.UHF.INTDUMP', oe_ints=['EIGENVALUES'])
compare_fcidumps('Ne.C1.cc-pVDZ.UHF.INTDUMP.ref', 'Ne.C1.cc-pVDZ.UHF.INTDUMP', '[5] Ne, C1, cc-pVDZ, UHF reference, integrals in FCIDUMP format', fci_tol) # TEST
