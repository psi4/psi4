#! Tests RHF CCSD(T)gradients

molecule h2o {
0 1
O
H 1 R
H 1 R 2 A

R = 1.0
A = 104.5
}

set {
   reference rhf
   basis 6-31g 
   r_convergence 13
   e_convergence 13
   d_convergence 13
   qc_module ccenergy  # signals to use the analytic ccsd(t) gradients
}

if psi4.core.get_option("scf", "orbital_optimizer_package") == "INTERNAL":
    tol = 8
else:
    psi4.set_options({"e_convergence": 10, "d_convergence": 3e-8})
    tol = 5e-8

analytic, wfn = gradient('ccsd(t)', return_wfn=True)
fin_diff = psi4.Matrix.from_list([                                      #TEST
             [ 0.00000000000000,     0.00000000000000,    -0.02788939642641],  # FINITE DIFFERENCE 5 POINT FORMULA
             [ 0.00000000000000,    -0.00904503210340,     0.01394469821321],
             [ 0.00000000000000,     0.00904503210340,     0.01394469821321]
           ])
compare_matrices(analytic, fin_diff, tol, "1. RHF-CCSD(T) gradient comparison with finite differences") #TEST

molecule N2 {
0 1
N 0 0 0
N 0 0 1.118928
symmetry C1
}

set {
   reference rhf
   basis 6-31g 
   e_convergence 13
   r_convergence 13
   d_convergence 13
}

if psi4.core.get_option("scf", "orbital_optimizer_package") != "INTERNAL":
    psi4.set_options({"e_convergence": 10, "d_convergence": 3e-8})

analytic, wfn = gradient('ccsd(t)', return_wfn=True)
fin_diff = psi4.Matrix.from_list([                                      #TEST
    [     0.00000000000000,     0.00000000000000,     0.03761158318898],  # FINITE DIFFERENCE 5 POINT FORMULA
    [     0.00000000000000,     0.00000000000000,    -0.03761158318898]
	   ])
compare_matrices(analytic, fin_diff, 8, "2. RHF-CCSD(T) gradient comparison with finite differences") #TEST


