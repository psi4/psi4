#! coupled-cluster with PCM
#! Perturbation-to-the-Energy-and-Density (PTED) algorithm


nucenergy = 1.4084507042253522 # TEST
scf_polenergy = -0.1538411942638307 # TEST
scf_totalenergy = -3.0767011601643377 # TEST
pted_polenergy = -0.000005991584194 # TEST
pted_correnergy = -0.036646172163364 # TEST
pted_totalenergy = -3.113347332327696 # TEST
#! Reference values from DALTON PCM-FCI calculation
fci_correnergy = -0.03664617216399968 # TEST
fci_totalenergy = -3.113347332292 # TEST

molecule HeH
{
  symmetry c1
  H  0.00000 0.00000 0.00000
  He 0.00000 0.00000 1.42000
  1 1
  units bohr
  no_reorient
  no_com
}

set
{
  basis cc-pVDZ
  scf_type pk
  pcm true
  pcm_scf_type total
  pcm_cc_type pted
  d_convergence 12

  e_convergence 12
  r_convergence 12
  ints_tolerance 20
}

pcm =
{
  Units = Angstrom
  Medium
  {
    SolverType = IEFPCM
    Solvent = Water
  }
  Cavity
  {
    Type = GePol
    Area = 0.3
    Mode = Implicit
  }
}

energy_pted, wfn = energy('ccsd', return_wfn=True)
compare_values(nucenergy, HeH.nuclear_repulsion_energy(), 10, "Nuclear repulsion energy (PCM, total algorithm)") # TEST
compare_values(scf_totalenergy, get_variable("SCF Total energy"), 10, "SCF Total energy (PCM, total algorithm)") # TEST
compare_values(scf_polenergy, get_variable("PCM POLARIZATION ENERGY"), 8, "SCF Polarization energy (PCM, total algorithm)") #TEST
compare_values(fci_totalenergy, energy_pted, 10, "FCI (DALTON) vs. CCSD Total energy (PCM PTED algorithm)") #TEST
compare_values(fci_correnergy, get_variable("CURRENT CORRELATION ENERGY"), 10, "FCI (DALTON) vs. CCSD Correlation energy (PCM PTED algorithm)") # TEST
compare_values(pted_totalenergy, energy_pted, 10, "CCSD Total energy (PCM PTED algorithm)") #TEST
compare_values(pted_correnergy, get_variable("CURRENT CORRELATION ENERGY"), 10, "CCSD Correlation energy (PCM PTED algorithm)") # TEST
compare_values(pted_polenergy, get_variable("PCM-CC-PTED CORRELATED POLARIZATION ENERGY"), 8, "CCSD Polarization energy (PCM PTED algorithm)") # TEST
