#! comparison of DF-CCSD(T) and DLPNO-CCSD(T)

ref_scf                  =    -76.0267872755965             #TEST

ref_dfccsd_corl          =     -0.211297075553              #TEST
ref_dfccsd_tot           =    -76.238084351147              #TEST
ref_dfccsd_t_corl        =     -0.214333036603              #TEST
ref_dfccsd_t_tot         =    -76.241120312197              #TEST

ref_dlpnoccsd_corl       =     -0.211288555887              #TEST
ref_dlpnoccsd_tot        =    -76.238075831483              #TEST
ref_dlpnoccsd_t_corl     =     -0.214331028550              #TEST
ref_dlpnoccsd_t_tot      =    -76.241118304145              #TEST

molecule h2o {
O
H 1 0.957
H 1 0.957 2 104.5
symmetry c1
}

set basis cc-pvdz
set freeze_core True
set scf_type df
set mp2_type df
set cc_type  df
set nat_orbs False
set e_convergence 1.0e-8
set r_convergence 1.0e-8

print('   Testing DF-CCSD(T) ...')
val = energy('ccsd(t)')

compare_values(ref_scf, variable('SCF TOTAL ENERGY'), 7, 'scf ref')                           #TEST
compare_values(ref_dfccsd_corl, variable('CCSD CORRELATION ENERGY'), 7, 'ccsd corl')          #TEST
compare_values(ref_dfccsd_tot, variable('CCSD TOTAL ENERGY'), 7, 'ccsd tot')                  #TEST
compare_values(ref_dfccsd_t_corl, variable('CCSD(T) CORRELATION ENERGY'), 7, 'ccsd(t) corl')  #TEST
compare_values(ref_dfccsd_t_tot, variable('CCSD(T) TOTAL ENERGY'), 7, 'ccsd(t) tot')          #TEST
compare_values(ref_scf, variable('CURRENT REFERENCE ENERGY'), 7, 'scf ref')                   #TEST
compare_values(ref_dfccsd_t_corl, variable('CURRENT CORRELATION ENERGY'), 7, 'ccsd(t) corl')  #TEST
compare_values(ref_dfccsd_t_tot, variable('CURRENT ENERGY'), 7, 'ccsd(t) tot')                #TEST
compare_values(ref_dfccsd_t_tot, val, 7, 'ccsd(t) return')                                    #TEST
clean()

print('   Testing DLPNO-CCSD(T) ...')
val = energy('dlpno-ccsd(t)')

# The DLPNO-CCSD(T) energy is close to the DF-CCSD(T) energy, but not exactly the same
compare_values(ref_scf, variable('SCF TOTAL ENERGY'), 7, 'scf ref')                              #TEST
compare_values(ref_dlpnoccsd_corl, variable('CCSD CORRELATION ENERGY'), 7, 'ccsd corl')          #TEST
compare_values(ref_dlpnoccsd_tot, variable('CCSD TOTAL ENERGY'), 7, 'ccsd tot')                  #TEST
compare_values(ref_dlpnoccsd_t_corl, variable('CCSD(T) CORRELATION ENERGY'), 7, 'ccsd(t) corl')  #TEST
compare_values(ref_dlpnoccsd_t_tot, variable('CCSD(T) TOTAL ENERGY'), 7, 'ccsd(t) tot')          #TEST
compare_values(ref_scf, variable('CURRENT REFERENCE ENERGY'), 7, 'scf ref')                      #TEST
compare_values(ref_dlpnoccsd_t_corl, variable('CURRENT CORRELATION ENERGY'), 7, 'ccsd(t) corl')  #TEST
compare_values(ref_dlpnoccsd_t_tot, variable('CURRENT ENERGY'), 7, 'ccsd(t) tot')                #TEST
compare_values(ref_dlpnoccsd_t_tot, val, 7, 'ccsd(t) return')                                    #TEST
clean()

set pno_convergence tight

print('   Testing DLPNO-CCSD(T) w/ tight settings ...')
val = energy('dlpno-ccsd(t)')

# DLPNO-CCSD(T) matches DF-CCSD(T) if the thresholds are tightened enough
compare_values(ref_scf, variable('SCF TOTAL ENERGY'), 7, 'scf ref')                           #TEST
compare_values(ref_dfccsd_corl, variable('CCSD CORRELATION ENERGY'), 5, 'ccsd corl')          #TEST
compare_values(ref_dfccsd_tot, variable('CCSD TOTAL ENERGY'), 5, 'ccsd tot')                  #TEST
compare_values(ref_dfccsd_t_corl, variable('CCSD(T) CORRELATION ENERGY'), 5, 'ccsd(t) corl')  #TEST
compare_values(ref_dfccsd_t_tot, variable('CCSD(T) TOTAL ENERGY'), 5, 'ccsd(t) tot')          #TEST
compare_values(ref_scf, variable('CURRENT REFERENCE ENERGY'), 7, 'scf ref')                   #TEST
compare_values(ref_dfccsd_t_corl, variable('CURRENT CORRELATION ENERGY'), 5, 'ccsd(t) corl')  #TEST
compare_values(ref_dfccsd_t_tot, variable('CURRENT ENERGY'), 5, 'ccsd(t) tot')                #TEST
compare_values(ref_dfccsd_t_tot, val, 5, 'ccsd(t) return')                                    #TEST
clean()