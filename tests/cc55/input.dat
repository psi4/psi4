#! EOM-CCSD/6-31g excited state transition data for water with
#! two excited states per irrep

molecule h2o {
  O
  H 1 R
  H 1 R 2 A

  R = 1.0
  A = 104.5

}

set {
  basis 6-31g
  print 1
  roots_per_irrep [2, 2, 2, 2]
}

wfn = properties('eom-ccsd', properties=['oscillator_strength'], return_wfn=True)[1]

### ccdensity checks

refnre     =   8.8014655645673745 # TEST
refscf     = -75.9801579219344205 # TEST
refccsd    = -76.119564846883890  # TEST
refoverlap =   0.95214891671      # TEST

compare_values(refnre, h2o.nuclear_repulsion_energy(), 6, "Nuclear Repulsion Energy") # TEST
compare_values(refscf, wfn.variable("SCF TOTAL ENERGY"), 6, "SCF Energy") # TEST
compare_values(refccsd, wfn.variable("CCSD TOTAL ENERGY"), 6, "CCSD Energy") # TEST
compare_values(refoverlap, wfn.variable("LEFT-RIGHT CCSD EIGENVECTOR OVERLAP"), 5, "Left-Right CCSD Overlap") # TEST

### Excitation energy checks

ref1A1 = -75.731653609639 # TEST
ref2A1 = -75.444482974730 # TEST
ref0A2 = -75.748354042274 # TEST
ref1A2 = -75.159059117138 # TEST
ref0B1 = -75.828418082855 # TEST
ref1B1 = -75.177505240374 # TEST
ref0B2 = -75.646805408168 # TEST
ref1B2 = -75.576701759343 # TEST

compare_values(ref1A1, core.variable("CCSD ROOT 1 (IN A1) TOTAL ENERGY"), 6, "Root 1 (A1) Energy") # TEST
compare_values(ref2A1, core.variable("CCSD ROOT 2 (IN A1) TOTAL ENERGY"), 6, "Root 2 (A1) Energy") # TEST
compare_values(ref0B1, core.variable("CCSD ROOT 0 (IN B1) TOTAL ENERGY"), 6, "Root 0 (B1) Energy") # TEST
compare_values(ref1B1, core.variable("CCSD ROOT 1 (IN B1) TOTAL ENERGY"), 6, "Root 1 (B1) Energy") # TEST
compare_values(ref0A2, core.variable("CCSD ROOT 0 (IN A2) TOTAL ENERGY"), 6, "Root 0 (A2) Energy") # TEST
compare_values(ref1A2, core.variable("CCSD ROOT 1 (IN A2) TOTAL ENERGY"), 6, "Root 1 (A2) Energy") # TEST
compare_values(ref0B2, core.variable("CCSD ROOT 0 (IN B2) TOTAL ENERGY"), 6, "Root 0 (B2) Energy") # TEST
compare_values(ref1B2, core.variable("CCSD ROOT 1 (IN B2) TOTAL ENERGY"), 6, "Root 1 (B2) Energy") # TEST

### Transition checks

test_data = { # TEST
"ROOT 0 (IN A1) -> ROOT 1 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.11765701, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 5.68844298e+08, "EINSTEIN B (LEN)": 5.53538025e+19}, # TEST
"ROOT 0 (IN A1) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.27865575, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 4.08029704e+09, "EINSTEIN B (LEN)": 7.53309728e+19}, # TEST
"ROOT 0 (IN A1) -> ROOT 0 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN A1) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN A1) -> ROOT 0 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.01020036, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 2.77811574e+07, "EINSTEIN B (LEN)": 6.39389598e+18}, # TEST
"ROOT 0 (IN A1) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.00013981, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 3.98656351e+06, "EINSTEIN B (LEN)": 2.70841165e+16}, # TEST
"ROOT 0 (IN A1) -> ROOT 0 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.11081089, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 7.95744713e+08, "EINSTEIN B (LEN)": 4.27764037e+19}, # TEST
"ROOT 0 (IN A1) -> ROOT 1 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.47778324, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 4.52399815e+09, "EINSTEIN B (LEN)": 1.60621107e+20}, # TEST
"ROOT 1 (IN A1) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.00057739, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.52987978e+06, "EINSTEIN B (LEN)": 3.66934337e+17}, # TEST
"ROOT 0 (IN A2) -> ROOT 1 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN A2) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 1 (IN A1) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 2 (IN A1) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN A2) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.02637458, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 2.94280787e+08, "EINSTEIN B (LEN)": 8.16798514e+18}, # TEST
"ROOT 0 (IN B1) -> ROOT 1 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.00183461, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 5.51932950e+05, "EINSTEIN B (LEN)": 3.46010792e+18}, # TEST
"ROOT 0 (IN B1) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.00072933, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 3.45424140e+06, "EINSTEIN B (LEN)": 3.46681236e+17}, # TEST
"ROOT 0 (IN B1) -> ROOT 0 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.13505618, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 2.78163630e+07, "EINSTEIN B (LEN)": 3.07849865e+20}, # TEST
"ROOT 0 (IN B1) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.00022287, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 3.20831735e+06, "EINSTEIN B (LEN)": 6.07646777e+16}, # TEST
"ROOT 1 (IN A1) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.00407585, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 4.02143425e+07, "EINSTEIN B (LEN)": 1.34231340e+18}, # TEST
"ROOT 2 (IN A1) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.00009918, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 2.27124828e+05, "EINSTEIN B (LEN)": 6.77938995e+16}, # TEST
"ROOT 0 (IN A2) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.00222211, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 2.32658437e+07, "EINSTEIN B (LEN)": 7.10406060e+17}, # TEST
"ROOT 1 (IN B1) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.00083485, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 9.12701408e+03, "EINSTEIN B (LEN)": 8.25970500e+18}, # TEST
"ROOT 0 (IN B1) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0.01452848, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.97777397e+08, "EINSTEIN B (LEN)": 4.07342072e+18}, # TEST
"ROOT 1 (IN A1) -> ROOT 0 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.14677067, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 3.39496613e+07, "EINSTEIN B (LEN)": 3.15688423e+20}, # TEST
"ROOT 0 (IN B2) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.01132526, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.48952309e+07, "EINSTEIN B (LEN)": 1.02156558e+19}, # TEST
"ROOT 0 (IN A2) -> ROOT 0 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.00210954, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 6.98949847e+05, "EINSTEIN B (LEN)": 3.79118423e+18}, # TEST
"ROOT 0 (IN B2) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.00404749, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 3.09374861e+07, "EINSTEIN B (LEN)": 1.51444752e+18}, # TEST
"ROOT 0 (IN B1) -> ROOT 0 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN B2) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 1 (IN A1) -> ROOT 1 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.00013457, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.03816191e+05, "EINSTEIN B (LEN)": 1.58498780e+17}, # TEST
"ROOT 1 (IN B2) -> ROOT 2 (IN A1)": {"OSCILLATOR STRENGTH (LEN)": 0.19251008, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.08131114e+08, "EINSTEIN B (LEN)": 2.65718827e+20}, # TEST
"ROOT 0 (IN A2) -> ROOT 1 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.00000678, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 6.41811830e+03, "EINSTEIN B (LEN)": 7.20792236e+15}, # TEST
"ROOT 1 (IN B2) -> ROOT 1 (IN A2)": {"OSCILLATOR STRENGTH (LEN)": 0.00113432, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 6.35705000e+06, "EINSTEIN B (LEN)": 4.95669569e+17}, # TEST
"ROOT 0 (IN B1) -> ROOT 1 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 1 (IN B2) -> ROOT 1 (IN B1)": {"OSCILLATOR STRENGTH (LEN)": 0, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 0, "EINSTEIN B (LEN)": 0}, # TEST
"ROOT 0 (IN B2) -> ROOT 1 (IN B2)": {"OSCILLATOR STRENGTH (LEN)": 0.00009225, "ROTATORY STRENGTH (LEN)": 0, "ROTATORY STRENGTH (VEL)": 0, "EINSTEIN A (LEN)": 1.45663529e+04, "EINSTEIN B (LEN)": 2.40148617e+17}, # TEST
}

for transition, data in test_data.items(): # TEST
    for property, value in data.items(): # TEST
        # Change these numbers to 6 ASAP # TEST
        if "EINSTEIN" not in property: # TEST
            compare_values(value, wfn.variable(f"CC {transition} {property}"), 4, f"CC {transition} {property}") # TEST
            compare_values(value, wfn.variable(f"CCSD {transition} {property}"), 4, f"CCSD {transition} {property}") # TEST
        else: # TEST 
            # Large numbers need "special" testing. # TEST
            compare_values(value, wfn.variable(f"CC {transition} {property}"), f"CC {transition} {property}", atol=1e-6, rtol=1e-4) # TEST
            compare_values(value, wfn.variable(f"CCSD {transition} {property}"), f"CCSD {transition} {property}", atol=1e-6, rtol=1e-4) # TEST


