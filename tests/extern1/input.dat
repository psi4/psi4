#! 
memory 500 mb

molecule {
  0 1
  O  -0.778803000000  0.000000000000  1.132683000000
  H  -0.666682000000  0.764099000000  1.706291000000
  H  -0.666682000000  -0.764099000000  1.706290000000
  symmetry c1
  no_reorient
  no_com
}

# Define a TIP3P water as the external potential
Chrgfield = QMMM()
Chrgfield.extern.addCharge(-0.834,1.649232019048,0.0,-2.356023604706)
Chrgfield.extern.addCharge(0.417,0.544757019107,0.0,-3.799961446760)
Chrgfield.extern.addCharge(0.417,0.544757019107,0.0,-0.912085762652)
psi4.set_global_option_python('EXTERN',Chrgfield.extern)

set {
    scf_type df
    d_convergence 12
    basis 6-31G*
}

gradient('scf', dertype=0)
fd_grad = psi4.wavefunction().gradient()
gradient('scf')
an_grad = psi4.wavefunction().gradient()

compare_matrices(an_grad, fd_grad, 5, "Finite difference (3-pt.) vs. analytic gradient to 10^-5") #TEST
