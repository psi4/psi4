


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>proc &mdash; Psithon for PSI4 documentation</title>
    
    <link rel="stylesheet" href="../_static/psi4.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toggle_sections.js"></script>
    <link rel="top" title="Psithon for PSI4 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
    <script type="text/javascript" src="../_static/copybutton.js"></script> 

  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="../index.html">Psithon for PSI4 Documentation</a> &raquo; </li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for proc</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Module with functions that encode the sequence of PSI module</span>
<span class="sd">calls for each of the *name* values of the energy(), optimize(),</span>
<span class="sd">response(), and frequency() function.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">PsiMod</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">input</span>
<span class="kn">import</span> <span class="nn">physconst</span>
<span class="kn">from</span> <span class="nn">molutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">text</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="run_dcft"><a class="viewcode-back" href="../index.html#proc.run_dcft">[docs]</a><span class="k">def</span> <span class="nf">run_dcft</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density cumulant functional theory calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">scf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dcft</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="run_scf"><a class="viewcode-back" href="../index.html#proc.run_scf">[docs]</a><span class="k">def</span> <span class="nf">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a self-consistent-field theory (HF &amp; DFT) calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_scf_gradient"><a class="viewcode-back" href="../index.html#proc.run_scf_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_scf_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a SCF gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="run_libfock"><a class="viewcode-back" href="../index.html#proc.run_libfock">[docs]</a><span class="k">def</span> <span class="nf">run_libfock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a calculation through libfock, namely RCPHF,</span>
<span class="sd">    RCIS, RTDHF, RTDA, and RTDDFT.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cphf&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RCPHF&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cis&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RCIS&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tdhf&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RTDHF&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cpks&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RCPKS&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tda&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RTDA&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tddft&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s">&#39;RTDDFT&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">libfock</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="run_mcscf"><a class="viewcode-back" href="../index.html#proc.run_mcscf">[docs]</a><span class="k">def</span> <span class="nf">run_mcscf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a multiconfigurational self-consistent-field calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">mcscf</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="scf_helper"><a class="viewcode-back" href="../index.html#proc.scf_helper">[docs]</a><span class="k">def</span> <span class="nf">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function serving as helper to SCF, choosing whether to cast</span>
<span class="sd">    up or just run SCF with a standard guess. This preserves</span>
<span class="sd">    previous SCF options set by other procedures (e.g., SAPT</span>
<span class="sd">    output file types for SCF).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cast</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s">&#39;cast_up&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">cast</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cast_up&#39;</span><span class="p">)</span>

    <span class="n">precallback</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">&#39;precallback&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">precallback</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;precallback&#39;</span><span class="p">)</span>

    <span class="n">postcallback</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">&#39;postcallback&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">postcallback</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;postcallback&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cast</span><span class="p">)):</span>
            <span class="n">custom</span> <span class="o">=</span> <span class="s">&#39;Default&#39;</span>
            <span class="n">guessbasis</span> <span class="o">=</span> <span class="s">&#39;3-21G&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom</span> <span class="o">=</span> <span class="s">&#39;Custom&#39;</span>
            <span class="n">guessbasis</span> <span class="o">=</span> <span class="n">cast</span>

        <span class="c"># Hack to ensure cartesian or pure are used throughout</span>
        <span class="c"># This touches the option, as if the user set it</span>
        <span class="n">puream</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s">&#39;PUREAM&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;PUREAM&#39;</span><span class="p">,</span> <span class="n">puream</span><span class="p">)</span>

        <span class="c"># Switch to the guess namespace</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">get_default_namespace</span><span class="p">()</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">((</span><span class="n">namespace</span> <span class="o">+</span> <span class="s">&#39;.guess&#39;</span><span class="p">))</span>

        <span class="c"># Are we in a DF algorithm here?</span>
        <span class="n">scf_type</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
        <span class="n">guess_type</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;GUESS&#39;</span><span class="p">)</span>
        <span class="n">df_basis_scf</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;DF_BASIS_SCF&#39;</span><span class="p">)</span>
        <span class="n">df_ints</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>

        <span class="c"># Which basis is the final one</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;BASIS&#39;</span><span class="p">)</span>

        <span class="c"># Setup initial SCF</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;BASIS&#39;</span><span class="p">,</span> <span class="n">guessbasis</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scf_type</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;DF_BASIS_SCF&#39;</span><span class="p">,</span> <span class="s">&#39;cc-pvdz-ri&#39;</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">)</span>

        <span class="c"># Print some info about the guess</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Guess SCF, </span><span class="si">%s</span><span class="s"> Basis&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">guessbasis</span><span class="p">))</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Perform the guess scf</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">scf</span><span class="p">()</span>

        <span class="c"># Move files to proper namespace</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="p">(</span><span class="n">namespace</span> <span class="o">+</span> <span class="s">&#39;.guess&#39;</span><span class="p">),</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

        <span class="c"># Set to read and project, and reset bases</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s">&#39;READ&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;BASIS&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scf_type</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;DF_BASIS_SCF&#39;</span><span class="p">,</span> <span class="n">df_basis_scf</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints</span><span class="p">)</span>

        <span class="c"># Print the banner for the standard operation</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">banner</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Do the full scf</span>
        <span class="n">e_scf</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">precallback</span><span class="p">,</span> <span class="n">postcallback</span><span class="p">)</span>

        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;GUESS&#39;</span><span class="p">,</span> <span class="n">guess_type</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">e_scf</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">precallback</span><span class="p">,</span> <span class="n">postcallback</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e_scf</span>

</div>
<div class="viewcode-block" id="run_mp2"><a class="viewcode-back" href="../index.html#proc.run_mp2">[docs]</a><span class="k">def</span> <span class="nf">run_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a MP2 calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;MP2&#39;</span><span class="p">)</span>

    <span class="c"># Bypass routine scf if user did something special to get it to converge</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s">&#39;bypass_scf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">input</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;bypass_scf&#39;</span><span class="p">]))):</span>
        <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;scf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">transqt2</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccsort</span><span class="p">()</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">mp2</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returnvalue</span>

</div>
<div class="viewcode-block" id="run_mp2_gradient"><a class="viewcode-back" href="../index.html#proc.run_mp2_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_mp2_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a MP2 gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="n">run_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;MP2&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;NONE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_ccenergy"><a class="viewcode-back" href="../index.html#proc.run_ccenergy">[docs]</a><span class="k">def</span> <span class="nf">run_ccenergy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a CCSD, CC2, and CC3 calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccsd(t)&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD_T&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cc2&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CC2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cc3&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CC3&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;eom-ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
    <span class="c"># Call a plain energy(&#39;ccenergy&#39;) and have full control over options,</span>
    <span class="c"># incl. wfn</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccenergy&#39;</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c"># Bypass routine scf if user did something special to get it to converge</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s">&#39;bypass_scf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">input</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;bypass_scf&#39;</span><span class="p">]))):</span>
        <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;scf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">transqt2</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccsort</span><span class="p">()</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccenergy</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;ccenergy&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returnvalue</span>

</div>
<div class="viewcode-block" id="run_cc_gradient"><a class="viewcode-back" href="../index.html#proc.run_cc_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_cc_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a CCSD and CCSD(T) gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="n">run_ccenergy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccsd(t)&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD_T&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cchbar</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cclambda</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;ccenergy&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;NONE&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_bccd"><a class="viewcode-back" href="../index.html#proc.run_bccd">[docs]</a><span class="k">def</span> <span class="nf">run_bccd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a Brueckner CCD calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;bccd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;BCCD&#39;</span><span class="p">)</span>

    <span class="c"># Bypass routine scf if user did something special to get it to</span>
    <span class="c"># converge</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s">&#39;bypass_scf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">input</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;bypass_scf&#39;</span><span class="p">]))):</span>
        <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;scf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DELETE_TEI&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">transqt2</span><span class="p">()</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccsort</span><span class="p">()</span>
        <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccenergy</span><span class="p">()</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;Brueckner convergence check: </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;BRUECKNER CONVERGED&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;BRUECKNER CONVERGED&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">returnvalue</span>

</div>
<div class="viewcode-block" id="run_bccd_t"><a class="viewcode-back" href="../index.html#proc.run_bccd_t">[docs]</a><span class="k">def</span> <span class="nf">run_bccd_t</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a Brueckner CCD(T) calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;BCCD_T&#39;</span><span class="p">)</span>
    <span class="n">run_bccd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">cctriples</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="run_cc_response"><a class="viewcode-back" href="../index.html#proc.run_cc_response">[docs]</a><span class="k">def</span> <span class="nf">run_cc_response</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a CC2 and CCSD calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;RESPONSE&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD&#39;</span><span class="p">)</span>
        <span class="n">run_ccenergy</span><span class="p">(</span><span class="s">&#39;ccsd&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cc2&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CC2&#39;</span><span class="p">)</span>
        <span class="n">run_ccenergy</span><span class="p">(</span><span class="s">&#39;cc2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;CC2&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cchbar</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cclambda</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccresponse</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;NONE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_eom_cc"><a class="viewcode-back" href="../index.html#proc.run_eom_cc">[docs]</a><span class="k">def</span> <span class="nf">run_eom_cc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an EOM-CC calculation, namely EOM-CC2, EOM-CCSD, and EOM-CC3.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;eom-ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">run_ccenergy</span><span class="p">(</span><span class="s">&#39;ccsd&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;eom-cc2&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">run_ccenergy</span><span class="p">(</span><span class="s">&#39;cc2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CC2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;eom-cc3&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">run_ccenergy</span><span class="p">(</span><span class="s">&#39;cc3&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CC3&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cchbar</span><span class="p">()</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">cceom</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returnvalue</span>

</div>
<div class="viewcode-block" id="run_eom_cc_gradient"><a class="viewcode-back" href="../index.html#proc.run_eom_cc_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_eom_cc_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an EOM-CCSD gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;eom-ccsd&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">run_eom_cc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cclambda</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;XI&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">cclambda</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;XI&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;NONE&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;DERTYPE&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_adc"><a class="viewcode-back" href="../index.html#proc.run_adc">[docs]</a><span class="k">def</span> <span class="nf">run_adc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an algebraic diagrammatic construction calculation.</span>

<span class="sd">    .. caution:: Get rid of active molecule lines- should be handled in energy.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">&#39;molecule&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">molecule</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;molecule&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">molecule</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValueNotSet</span><span class="p">(</span><span class="s">&#39;no molecule found&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">scf</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">adc</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="run_detci"><a class="viewcode-back" href="../index.html#proc.run_detci">[docs]</a><span class="k">def</span> <span class="nf">run_detci</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a configuration interaction calculation, namely FCI,</span>
<span class="sd">    CIn, MPn, and ZAPTn.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;zapt&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;ZAPTN&#39;</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">maxnvect</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MAX_NUM_VECS&#39;</span><span class="p">,</span> <span class="n">maxnvect</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;mp&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)</span>

        <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">maxnvect</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MAX_NUM_VECS&#39;</span><span class="p">,</span> <span class="n">maxnvect</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;fci&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;FCI&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cisd&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cisdt&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cisdtq&#39;</span><span class="p">):</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
            <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ci&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="c"># Call a plain energy(&#39;detci&#39;) and have full control over options</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;detci&#39;</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c"># Bypass routine scf if user did something special to get it to converge</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s">&#39;bypass_scf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">input</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;bypass_scf&#39;</span><span class="p">]))):</span>
        <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;scf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">transqt2</span><span class="p">()</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">detci</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;detci&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">,</span> <span class="s">&#39;SCF&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;WFN&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;MPN&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MAX_NUM_VECS&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;MAX_NUM_VECS&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;FCI&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;FCI&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s">&#39;EX_LEVEL&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returnvalue</span>

</div>
<div class="viewcode-block" id="run_dfmp2"><a class="viewcode-back" href="../index.html#proc.run_dfmp2">[docs]</a><span class="k">def</span> <span class="nf">run_dfmp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted MP2 calculation.</span>

<span class="sd">    .. caution:: Get rid of madness-era restart file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s">&#39;restart_file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">restartfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;restart_file&#39;</span><span class="p">)</span>
        <span class="c"># Rename the checkpoint file to be consistent with psi4&#39;s file system</span>
        <span class="n">psioh</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span>
        <span class="n">psio</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">psioh</span><span class="o">.</span><span class="n">get_file_path</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">psio</span><span class="o">.</span><span class="n">get_default_namespace</span><span class="p">()</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;psi&#39;</span>
        <span class="n">targetfile</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">pid</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s">&#39;.32&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">PsiMod</span><span class="o">.</span><span class="n">me</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">restartfile</span><span class="p">,</span> <span class="n">targetfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;DFMP2&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_dfmp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">()</span>
    <span class="n">e_scs_dfmp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;SCS-DF-MP2 ENERGY&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;SCS-DFMP2&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">e_scs_dfmp2</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;DFMP2&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">e_dfmp2</span>

</div>
<div class="viewcode-block" id="run_mp2drpa"><a class="viewcode-back" href="../index.html#proc.run_mp2drpa">[docs]</a><span class="k">def</span> <span class="nf">run_mp2drpa</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a MP2-DRPA calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e_scf</span> <span class="o">=</span> <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;DFMP2&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_dfmp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">()</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;dRPA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfcc</span><span class="p">()</span>
    <span class="n">e_delta</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;RPA SCALED DELTA ENERGY&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;MP2/dRPA Analysis&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  Reference Energy               </span><span class="si">%20.14f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e_scf</span><span class="p">))</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  MP2 Correlation Energy         </span><span class="si">%20.14f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e_dfmp2</span> <span class="o">-</span> <span class="n">e_scf</span><span class="p">))</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  MP2 Total Energy               </span><span class="si">%20.14f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e_dfmp2</span><span class="p">))</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  Scaled dRPA/MP2J Delta Energy  </span><span class="si">%20.14f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e_delta</span><span class="p">))</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  Total MP2/dRPA Energy          </span><span class="si">%20.14f</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e_dfmp2</span> <span class="o">+</span> <span class="n">e_delta</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">e_dfmp2</span> <span class="o">+</span> <span class="n">e_delta</span>

</div>
<div class="viewcode-block" id="run_dfcc"><a class="viewcode-back" href="../index.html#proc.run_dfcc">[docs]</a><span class="k">def</span> <span class="nf">run_dfcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted coupled-cluster calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_scf</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;DF-CC&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_dfcc</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfcc</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">e_dfcc</span>
</div>
<div class="viewcode-block" id="run_psimrcc"><a class="viewcode-back" href="../index.html#proc.run_psimrcc">[docs]</a><span class="k">def</span> <span class="nf">run_psimrcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for a PSIMRCC computation</span>
<span class="sd">     using a reference from the MCSCF module</span>

<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="n">run_mcscf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">psimrcc</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="run_psimrcc_scf"><a class="viewcode-back" href="../index.html#proc.run_psimrcc_scf">[docs]</a><span class="k">def</span> <span class="nf">run_psimrcc_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for a PSIMRCC computation</span>
<span class="sd">     using a reference from the SCF module</span>

<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">psimrcc</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="run_mp2c"><a class="viewcode-back" href="../index.html#proc.run_mp2c">[docs]</a><span class="k">def</span> <span class="nf">run_mp2c</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a coupled MP2 calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">()</span>
    <span class="n">molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
    <span class="n">monomerA</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">monomerB</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>

    <span class="n">ri</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
    <span class="n">df_ints_io</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Dimer HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">e_dimer</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Dimer DFMP2&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_dimer_mp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;LOAD&#39;</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerA</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_A&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer A HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerA</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer A DFMP2&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerA_mp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">()</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerB</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_B&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer B HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerB</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer B DFMP2&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerB_mp2</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">()</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints_io</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;D_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;MP2C&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;MP2C&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s">&#39;MP2C DIMER MP2 ENERGY&#39;</span><span class="p">,</span> <span class="n">e_dimer_mp2</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s">&#39;MP2C MONOMER A MP2 ENERGY&#39;</span><span class="p">,</span> <span class="n">e_monomerA_mp2</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s">&#39;MP2C MONOMER B MP2 ENERGY&#39;</span><span class="p">,</span> <span class="n">e_monomerB_mp2</span><span class="p">)</span>

    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">sapt</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">e_sapt</span>

</div>
<div class="viewcode-block" id="run_sapt"><a class="viewcode-back" href="../index.html#proc.run_sapt">[docs]</a><span class="k">def</span> <span class="nf">run_sapt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a SAPT calculation of any level.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">molecule</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">()</span>

    <span class="n">sapt_basis</span> <span class="o">=</span> <span class="s">&#39;dimer&#39;</span>
    <span class="k">if</span> <span class="s">&#39;sapt_basis&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">sapt_basis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;sapt_basis&#39;</span><span class="p">)</span>
    <span class="n">sapt_basis</span> <span class="o">=</span> <span class="n">sapt_basis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;dimer&#39;</span><span class="p">):</span>
        <span class="n">molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
        <span class="n">monomerA</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
        <span class="n">monomerB</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;monomer&#39;</span><span class="p">):</span>
        <span class="n">molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
        <span class="n">monomerA</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
        <span class="n">monomerB</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>

    <span class="n">ri</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
    <span class="n">df_ints_io</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Dimer HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;dimer&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">e_dimer</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;dimer&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;LOAD&#39;</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerA</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span> <span class="ow">and</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;dimer&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_A&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer A HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerA</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerB</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span> <span class="ow">and</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s">&#39;dimer&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_B&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer B HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerB</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints_io</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;D_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt0&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT0&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+(3)&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+3&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">sapt</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">e_sapt</span>

</div>
<div class="viewcode-block" id="run_sapt_ct"><a class="viewcode-back" href="../index.html#proc.run_sapt_ct">[docs]</a><span class="k">def</span> <span class="nf">run_sapt_ct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a charge-transfer SAPT calcuation of any level.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">()</span>
    <span class="n">molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
    <span class="n">monomerA</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">monomerB</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
    <span class="n">monomerAm</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">monomerAm</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerAm&#39;</span><span class="p">)</span>
    <span class="n">monomerBm</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">monomerBm</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&#39;monomerBm&#39;</span><span class="p">)</span>

    <span class="n">ri</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
    <span class="n">df_ints_io</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Dimer HF&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">e_dimer</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s">&#39;LOAD&#39;</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerA</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_A&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer A HF (Dimer Basis)&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerA</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerB</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_B&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer B HF (Dimer Basis)&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerB</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints_io</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerAm</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerAm&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_A&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer A HF (Monomer Basis)&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerA</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">monomerBm</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;monomerBm&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SCF&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;2-monomer_B&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer B HF (Monomer Basis)&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">e_monomerB</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s">&#39;RHF&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">activate</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;D_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt0-ct&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT0&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2-ct&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+-ct&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+(3)-ct&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sapt2+3-ct&#39;</span><span class="p">):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;SAPT Charge Transfer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Dimer Basis SAPT&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="s">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="s">&#39;monomerB&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">sapt</span><span class="p">()</span>
    <span class="n">CTd</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;SAPT CT ENERGY&#39;</span><span class="p">)</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Monomer Basis SAPT&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="s">&#39;monomerAm&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="s">&#39;monomerBm&#39;</span><span class="p">,</span> <span class="s">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">sapt</span><span class="p">()</span>
    <span class="n">CTm</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;SAPT CT ENERGY&#39;</span><span class="p">)</span>
    <span class="n">CT</span> <span class="o">=</span> <span class="n">CTd</span> <span class="o">-</span> <span class="n">CTm</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;    SAPT Charge Transfer Analysis</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;  -----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="s">&#39;    SAPT Induction (Dimer Basis)      </span><span class="si">%10.4lf</span><span class="s"> mH    </span><span class="si">%10.4lf</span><span class="s"> kcal mol^-1</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CTd</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">CTd</span> <span class="o">*</span> <span class="n">physconst</span><span class="o">.</span><span class="n">psi_hartree2kcalmol</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">=</span> <span class="s">&#39;    SAPT Induction (Monomer Basis)    </span><span class="si">%10.4lf</span><span class="s"> mH    </span><span class="si">%10.4lf</span><span class="s"> kcal mol^-1</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CTm</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">CTm</span> <span class="o">*</span> <span class="n">physconst</span><span class="o">.</span><span class="n">psi_hartree2kcalmol</span><span class="p">)</span>
    <span class="n">line3</span> <span class="o">=</span> <span class="s">&#39;    SAPT Charge Transfer              </span><span class="si">%10.4lf</span><span class="s"> mH    </span><span class="si">%10.4lf</span><span class="s"> kcal mol^-1</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CT</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">CT</span> <span class="o">*</span> <span class="n">physconst</span><span class="o">.</span><span class="n">psi_hartree2kcalmol</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="n">line3</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s">&#39;SAPT CT ENERGY&#39;</span><span class="p">,</span> <span class="n">CT</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e_sapt</span>

</div>
<div class="viewcode-block" id="run_mrcc"><a class="viewcode-back" href="../index.html#proc.run_mrcc">[docs]</a><span class="k">def</span> <span class="nf">run_mrcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that prepares environment and input files</span>
<span class="sd">    for a calculation calling Kallay&#39;s MRCC code.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO: Check to see if we really need to run the SCF code.</span>
    <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c"># The parse_arbitrary_order method provides us the following information</span>
    <span class="c"># We require that level be provided. level is a dictionary</span>
    <span class="c"># of settings to be passed to PsiMod.mrcc</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s">&#39;level&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">&#39;level parameter was not provided.&#39;</span><span class="p">)</span>

    <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;level&#39;</span><span class="p">]</span>

    <span class="c"># Fullname is the string we need to search for in iface</span>
    <span class="n">fullname</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="s">&#39;fullname&#39;</span><span class="p">]</span>

    <span class="c"># User can provide &#39;keep&#39; to the method.</span>
    <span class="c"># When provided, do not delete the MRCC scratch directory.</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s">&#39;keep&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;keep&#39;</span><span class="p">]</span>

    <span class="c"># Save current directory location</span>
    <span class="n">current_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c"># Need to move to the scratch directory, perferrably into a separate directory in that location</span>
    <span class="n">psi_io</span> <span class="o">=</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">psi_io</span><span class="o">.</span><span class="n">get_default_path</span><span class="p">())</span>

    <span class="c"># Make new directory specifically for mrcc</span>
    <span class="n">mrcc_tmpdir</span> <span class="o">=</span> <span class="s">&#39;mrcc_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="k">if</span> <span class="s">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">mrcc_tmpdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span>

    <span class="c"># Check to see if directory already exists, if not, create.</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c"># Move into the new directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c"># Generate integrals and input file (dumps files to the current directory)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">mrcc_generate_input</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

    <span class="c"># Load the fort.56 file</span>
    <span class="c"># and dump a copy into the outfile</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">===== Begin fort.56 input for MRCC ======</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;fort.56&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;===== End   fort.56 input for MRCC ======</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c"># Close output file</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">close_outfile</span><span class="p">()</span>

    <span class="c"># Modify the environment:</span>
    <span class="c">#    PGI Fortan prints warning to screen if STOP is used</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;NO_STOP_MESSAGE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>

    <span class="c"># Obtain user&#39;s OMP_NUM_THREADS so that we don&#39;t blow it away.</span>
    <span class="n">omp_num_threads_found</span> <span class="o">=</span> <span class="s">&#39;OMP_NUM_THREADS&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
    <span class="k">if</span> <span class="n">omp_num_threads_found</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">omp_num_threads_user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span>

    <span class="c"># If the user provided MRCC_OMP_NUM_THREADS set the environ to it</span>
    <span class="k">if</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PsiMod</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">))</span>

    <span class="c"># Call dmrcc, directing all screen output to the output file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">outfile_name</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;stdout&#39;</span><span class="p">:</span>
            <span class="n">retcode</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;dmrcc&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">retcode</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;dmrcc &gt;&gt; &#39;</span> <span class="o">+</span> <span class="n">current_directory</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">outfile_name</span><span class="p">(),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retcode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;MRCC was terminated by signal&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">retcode</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">retcode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;MRCC errored&#39;</span><span class="p">,</span> <span class="n">retcode</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;Execution failed:&#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># Restore the OMP_NUM_THREADS that the user set.</span>
    <span class="k">if</span> <span class="n">omp_num_threads_found</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PsiMod</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omp_num_threads_user</span>

    <span class="c"># Scan iface file and grab the file energy.</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">(</span><span class="s">&#39;iface&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">fullname</span> <span class="o">+</span> <span class="s">&#39; ENERGY&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c"># Load the iface file</span>
    <span class="n">iface</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;iface&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">iface_contents</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c"># Delete mrcc tempdir</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">&#39;..&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Delete unless we&#39;re told not to</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">keep</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="s">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">OSerror</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;Unable to remove MRCC temporary directory&#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># Revert to previous current directory location</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">current_directory</span><span class="p">)</span>

    <span class="c"># Reopen output file</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">reopen_outfile</span><span class="p">()</span>

    <span class="c"># If we&#39;re told to keep the files or the user provided a path, do nothing.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">keep</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)):</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">MRCC scratch files have been kept.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;They can be found in &#39;</span> <span class="o">+</span> <span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c"># Dump iface contents to output</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;Full results from MRCC&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">PsiMod</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="n">iface_contents</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="../index.html">Psithon for PSI4 Documentation</a> &raquo; </li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012, Psi4 Project.
      Last updated on Feb 25, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>